var e={"./node_modules/onnxruntime-web/dist/ort-wasm-simd-threaded.asyncify.wasm":
/*!********************************************************************************!*\
  !*** ./node_modules/onnxruntime-web/dist/ort-wasm-simd-threaded.asyncify.wasm ***!
  \********************************************************************************/(e,t,r)=>{e.exports=r.p+"aa2a6c407dffa367d229.wasm"},"./node_modules/onnxruntime-web/dist/ort.webgpu.bundle.min.mjs?3e05":
/*!*********************************************************************!*\
  !*** ./node_modules/onnxruntime-web/dist/ort.webgpu.bundle.min.mjs ***!
  \*********************************************************************/(e,t,r)=>{e.exports=r.p+"7fd6f237f2818b16070c.mjs"},"./node_modules/onnxruntime-web/dist/ort.webgpu.bundle.min.mjs?79d7":
/*!*********************************************************************!*\
  !*** ./node_modules/onnxruntime-web/dist/ort.webgpu.bundle.min.mjs ***!
  \*********************************************************************/(e,t,r)=>{r.r(t),r.d(t,{InferenceSession:()=>j,TRACE:()=>S,TRACE_EVENT_BEGIN:()=>R,TRACE_EVENT_END:()=>$,TRACE_FUNC_BEGIN:()=>U,TRACE_FUNC_END:()=>M,Tensor:()=>I,default:()=>Rr,env:()=>c,registerBackend:()=>o});
/*!
 * ONNX Runtime Web v1.23.2
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
var n,i,a,o,s,l,u,f,d,c,p,h,y,m,w,g,b,v,C,_,T,E,x,A,O,I,S,B,U,M,R,$,P,j,L=Object.defineProperty,k=Object.getOwnPropertyDescriptor,D=Object.getOwnPropertyNames,N=Object.prototype.hasOwnProperty,W=(n=function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')},typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):n),G=(e,t)=>()=>(e&&(t=e(e=0)),t),F=(e,t)=>{for(var r in t)L(e,r,{get:t[r],enumerable:!0})},V=e=>((e,t,r,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of D(t))!N.call(e,i)&&i!==r&&L(e,i,{get:()=>t[i],enumerable:!(n=k(t,i))||n.enumerable});return e})(L({},"__esModule",{value:!0}),e),z=G(()=>{i=new Map,a=[],o=(e,t,r)=>{if(t&&"function"==typeof t.init&&"function"==typeof t.createInferenceSessionHandler){let n=i.get(e);if(void 0===n)i.set(e,{backend:t,priority:r});else{if(n.priority>r)return;if(n.priority===r&&n.backend!==t)throw new Error(`cannot register backend "${e}" using priority ${r}`)}if(r>=0){let t=a.indexOf(e);-1!==t&&a.splice(t,1);for(let t=0;t<a.length;t++)if(i.get(a[t]).priority<=r)return void a.splice(t,0,e);a.push(e)}return}throw new TypeError("not a valid backend")},s=async e=>{let t=i.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let r=!!t.initPromise;try{return r||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(e){return r||(t.error=`${e}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},l=async e=>{let t,r=e.executionProviders||[],n=r.map(e=>"string"==typeof e?e:e.name),i=0===n.length?a:n,o=[],l=new Set;for(let e of i){let r=await s(e);"string"==typeof r?o.push({name:e,err:r}):(t||(t=r),t===r&&l.add(e))}if(!t)throw new Error(`no available backend found. ERR: ${o.map(e=>`[${e.name}] ${e.err}`).join(", ")}`);for(let{name:e,err:t}of o)n.includes(e)&&console.warn(`removing requested execution provider "${e}" from session options because it is not available: ${t}`);let u=r.filter(e=>l.has("string"==typeof e?e:e.name));return[t,new Proxy(e,{get:(e,t)=>"executionProviders"===t?u:Reflect.get(e,t)})]}}),H=G(()=>{z()}),q=G(()=>{u="1.23.2"}),Y=G(()=>{q(),f="warning",d={wasm:{},webgl:{},webgpu:{},versions:{common:u},set logLevel(e){if(void 0!==e){if("string"!=typeof e||-1===["verbose","info","warning","error","fatal"].indexOf(e))throw new Error(`Unsupported logging level: ${e}`);f=e}},get logLevel(){return f}},Object.defineProperty(d,"logLevel",{enumerable:!0})}),Z=G(()=>{Y(),c=d}),X=G(()=>{p=(e,t)=>{let r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=e.dims[3],r.height=e.dims[2];let n=r.getContext("2d");if(null!=n){let i,a;void 0!==t?.tensorLayout&&"NHWC"===t.tensorLayout?(i=e.dims[2],a=e.dims[3]):(i=e.dims[3],a=e.dims[2]);let o,s,l=void 0!==t?.format?t.format:"RGB",u=t?.norm;void 0===u||void 0===u.mean?o=[255,255,255,255]:"number"==typeof u.mean?o=[u.mean,u.mean,u.mean,u.mean]:(o=[u.mean[0],u.mean[1],u.mean[2],0],void 0!==u.mean[3]&&(o[3]=u.mean[3])),void 0===u||void 0===u.bias?s=[0,0,0,0]:"number"==typeof u.bias?s=[u.bias,u.bias,u.bias,u.bias]:(s=[u.bias[0],u.bias[1],u.bias[2],0],void 0!==u.bias[3]&&(s[3]=u.bias[3]));let f=a*i,d=0,c=f,p=2*f,h=-1;"RGBA"===l?(d=0,c=f,p=2*f,h=3*f):"RGB"===l?(d=0,c=f,p=2*f):"RBG"===l&&(d=0,p=f,c=2*f);for(let t=0;t<a;t++)for(let r=0;r<i;r++){let i=(e.data[d++]-s[0])*o[0],a=(e.data[c++]-s[1])*o[1],l=(e.data[p++]-s[2])*o[2],u=-1===h?255:(e.data[h++]-s[3])*o[3];n.fillStyle="rgba("+i+","+a+","+l+","+u+")",n.fillRect(r,t,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}throw new Error("Can not access image data")},h=(e,t)=>{let r,n=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");if(null==n)throw new Error("Can not access image data");{let i,a,o;void 0!==t?.tensorLayout&&"NHWC"===t.tensorLayout?(i=e.dims[2],a=e.dims[1],o=e.dims[3]):(i=e.dims[3],a=e.dims[2],o=e.dims[1]);let s,l,u=void 0!==t&&void 0!==t.format?t.format:"RGB",f=t?.norm;void 0===f||void 0===f.mean?s=[255,255,255,255]:"number"==typeof f.mean?s=[f.mean,f.mean,f.mean,f.mean]:(s=[f.mean[0],f.mean[1],f.mean[2],255],void 0!==f.mean[3]&&(s[3]=f.mean[3])),void 0===f||void 0===f.bias?l=[0,0,0,0]:"number"==typeof f.bias?l=[f.bias,f.bias,f.bias,f.bias]:(l=[f.bias[0],f.bias[1],f.bias[2],0],void 0!==f.bias[3]&&(l[3]=f.bias[3]));let d=a*i;if(void 0!==t&&(void 0!==t.format&&4===o&&"RGBA"!==t.format||3===o&&"RGB"!==t.format&&"BGR"!==t.format))throw new Error("Tensor format doesn't match input tensor dims");let c=4,p=0,h=1,y=2,m=3,w=0,g=d,b=2*d,v=-1;"RGBA"===u?(w=0,g=d,b=2*d,v=3*d):"RGB"===u?(w=0,g=d,b=2*d):"RBG"===u&&(w=0,b=d,g=2*d),r=n.createImageData(i,a);for(let t=0;t<a*i;p+=c,h+=c,y+=c,m+=c,t++)r.data[p]=(e.data[w++]-l[0])*s[0],r.data[h]=(e.data[g++]-l[1])*s[1],r.data[y]=(e.data[b++]-l[2])*s[2],r.data[m]=-1===v?255:(e.data[v++]-l[3])*s[3]}return r}}),Q=G(()=>{ee(),y=(e,t)=>{if(void 0===e)throw new Error("Image buffer must be defined");if(void 0===t.height||void 0===t.width)throw new Error("Image height and width must be defined");if("NHWC"===t.tensorLayout)throw new Error("NHWC Tensor layout is not supported yet");let r,n,{height:i,width:a}=t,o=t.norm??{mean:255,bias:0};r="number"==typeof o.mean?[o.mean,o.mean,o.mean,o.mean]:[o.mean[0],o.mean[1],o.mean[2],o.mean[3]??255],n="number"==typeof o.bias?[o.bias,o.bias,o.bias,o.bias]:[o.bias[0],o.bias[1],o.bias[2],o.bias[3]??0];let s=void 0!==t.format?t.format:"RGBA",l=void 0!==t.tensorFormat&&void 0!==t.tensorFormat?t.tensorFormat:"RGB",u=i*a,f="RGBA"===l?new Float32Array(4*u):new Float32Array(3*u),d=4,c=0,p=1,h=2,y=3,m=0,w=u,g=2*u,b=-1;"RGB"===s&&(d=3,c=0,p=1,h=2,y=-1),"RGBA"===l?b=3*u:"RBG"===l?(m=0,g=u,w=2*u):"BGR"===l&&(g=0,w=u,m=2*u);for(let t=0;t<u;t++,c+=d,h+=d,p+=d,y+=d)f[m++]=(e[c]+n[0])/r[0],f[w++]=(e[p]+n[1])/r[1],f[g++]=(e[h]+n[2])/r[2],-1!==b&&-1!==y&&(f[b++]=(e[y]+n[3])/r[3]);return new O("float32",f,"RGBA"===l?[1,4,i,a]:[1,3,i,a])},m=async(e,t)=>{let r,n=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,i=typeof ImageData<"u"&&e instanceof ImageData,a=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,o="string"==typeof e,s=t??{},l=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},u=e=>typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext("2d"):null;if(n){let n=l();n.width=e.width,n.height=e.height;let i=u(n);if(null==i)throw new Error("Can not access image data");{let n=e.height,a=e.width;if(void 0!==t&&void 0!==t.resizedHeight&&void 0!==t.resizedWidth&&(n=t.resizedHeight,a=t.resizedWidth),void 0!==t){if(s=t,void 0!==t.tensorFormat)throw new Error("Image input config format must be RGBA for HTMLImageElement");s.tensorFormat="RGBA",s.height=n,s.width=a}else s.tensorFormat="RGBA",s.height=n,s.width=a;i.drawImage(e,0,0),r=i.getImageData(0,0,a,n).data}}else{if(!i){if(a){if(void 0===t)throw new Error("Please provide image config with format for Imagebitmap");let n=l();n.width=e.width,n.height=e.height;let i=u(n);if(null!=i){let t=e.height,n=e.width;return i.drawImage(e,0,0,n,t),r=i.getImageData(0,0,n,t).data,s.height=t,s.width=n,y(r,s)}throw new Error("Can not access image data")}if(o)return new Promise((t,r)=>{let n=l(),i=u(n);if(!e||!i)return r();let a=new Image;a.crossOrigin="Anonymous",a.src=e,a.onload=()=>{n.width=a.width,n.height=a.height,i.drawImage(a,0,0,n.width,n.height);let e=i.getImageData(0,0,n.width,n.height);s.height=n.height,s.width=n.width,t(y(e.data,s))}});throw new Error("Input data provided is not supported - aborted tensor creation")}{let n,i;if(void 0!==t&&void 0!==t.resizedWidth&&void 0!==t.resizedHeight?(n=t.resizedHeight,i=t.resizedWidth):(n=e.height,i=e.width),void 0!==t&&(s=t),s.format="RGBA",s.height=n,s.width=i,void 0!==t){let t=l();t.width=i,t.height=n;let a=u(t);if(null==a)throw new Error("Can not access image data");a.putImageData(e,0,0),r=a.getImageData(0,0,i,n).data}else r=e.data}}if(void 0!==r)return y(r,s);throw new Error("Input data provided is not supported - aborted tensor creation")},w=(e,t)=>{let{width:r,height:n,download:i,dispose:a}=t;return new O({location:"texture",type:"float32",texture:e,dims:[1,n,r,4],download:i,dispose:a})},g=(e,t)=>{let{dataType:r,dims:n,download:i,dispose:a}=t;return new O({location:"gpu-buffer",type:r??"float32",gpuBuffer:e,dims:n,download:i,dispose:a})},b=(e,t)=>{let{dataType:r,dims:n,download:i,dispose:a}=t;return new O({location:"ml-tensor",type:r??"float32",mlTensor:e,dims:n,download:i,dispose:a})},v=(e,t,r)=>new O({location:"cpu-pinned",type:e,data:t,dims:r??[t.length]})}),K=G(()=>{C=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),_=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),T=!1,E=()=>{if(!T){T=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,r=globalThis.Float16Array,n=typeof r<"u"&&r.from;e&&(C.set("int64",BigInt64Array),_.set(BigInt64Array,"int64")),t&&(C.set("uint64",BigUint64Array),_.set(BigUint64Array,"uint64")),n?(C.set("float16",r),_.set(r,"float16")):C.set("float16",Uint16Array)}}}),J=G(()=>{ee(),x=e=>{let t=1;for(let r=0;r<e.length;r++){let n=e[r];if("number"!=typeof n||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);t*=n}return t},A=(e,t)=>{switch(e.location){case"cpu":return new O(e.type,e.data,t);case"cpu-pinned":return new O({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new O({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new O({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new O({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),ee=G(()=>{X(),Q(),K(),J(),O=class{constructor(e,t,r){let n,i;if(E(),"object"==typeof e&&"location"in e)switch(this.dataLocation=e.location,n=e.type,i=e.dims,e.location){case"cpu-pinned":{let t=C.get(n);if(!t)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(e.data instanceof t))throw new TypeError(`buffer should be of type ${t.name}`);this.cpuData=e.data;break}case"texture":if("float32"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break;case"gpu-buffer":if("float32"!==n&&"float16"!==n&&"int32"!==n&&"int64"!==n&&"uint32"!==n&&"uint8"!==n&&"bool"!==n&&"uint4"!==n&&"int4"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break;case"ml-tensor":if("float32"!==n&&"float16"!==n&&"int32"!==n&&"int64"!==n&&"uint32"!==n&&"uint64"!==n&&"int8"!==n&&"uint8"!==n&&"bool"!==n&&"uint4"!==n&&"int4"!==n)throw new TypeError(`unsupported type "${n}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break;default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let a,o;if("string"==typeof e)if(n=e,o=r,"string"===e){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");a=t}else{let r=C.get(e);if(void 0===r)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t)){if("float16"===e&&r===Uint16Array||"uint4"===e||"int4"===e)throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${r.name} as data.`);a="uint64"===e||"int64"===e?r.from(t,BigInt):r.from(t)}else if(t instanceof r)a=t;else if(t instanceof Uint8ClampedArray){if("uint8"!==e)throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");a=Uint8Array.from(t)}else{if(!("float16"===e&&t instanceof Uint16Array&&r!==Uint16Array))throw new TypeError(`A ${n} tensor's data must be type of ${r}`);a=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length)}}else if(o=t,Array.isArray(e)){if(0===e.length)throw new TypeError("Tensor type cannot be inferred from an empty array.");let t=typeof e[0];if("string"===t)n="string",a=e;else{if("boolean"!==t)throw new TypeError(`Invalid element type of data array: ${t}.`);n="bool",a=Uint8Array.from(e)}}else if(e instanceof Uint8ClampedArray)n="uint8",a=Uint8Array.from(e);else{let t=_.get(e.constructor);if(void 0===t)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);n=t,a=e}if(void 0===o)o=[a.length];else if(!Array.isArray(o))throw new TypeError("A tensor's dims must be a number array");i=o,this.cpuData=a,this.dataLocation="cpu"}let a=x(i);if(this.cpuData&&a!==this.cpuData.length&&("uint4"!==n&&"int4"!==n||Math.ceil(a/2)!==this.cpuData.length))throw new Error(`Tensor's size(${a}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=i,this.size=a}static async fromImage(e,t){return m(e,t)}static fromTexture(e,t){return w(e,t)}static fromGpuBuffer(e,t){return g(e,t)}static fromMLTensor(e,t){return b(e,t)}static fromPinnedBuffer(e,t,r){return v(e,t,r)}toDataURL(e){return p(this,e)}toImageData(e){return h(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if("none"===this.dataLocation)throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return A(this,e)}}}),te=G(()=>{ee(),I=O}),re=G(()=>{Y(),S=(e,t)=>{(typeof d.trace>"u"?!d.wasm.trace:!d.trace)||console.timeStamp(`${e}::ORT::${t}`)},B=(e,t)=>{let r=(new Error).stack?.split(/\r\n|\r|\n/g)||[],n=!1;for(let i=0;i<r.length;i++){if(n&&!r[i].includes("TRACE_FUNC")){let n=`FUNC_${e}::${r[i].trim().split(" ")[1]}`;return t&&(n+=`::${t}`),void S("CPU",n)}r[i].includes("TRACE_FUNC")&&(n=!0)}},U=e=>{(typeof d.trace>"u"?!d.wasm.trace:!d.trace)||B("BEGIN",e)},M=e=>{(typeof d.trace>"u"?!d.wasm.trace:!d.trace)||B("END",e)},R=e=>{(typeof d.trace>"u"?!d.wasm.trace:!d.trace)||console.time(`ORT::${e}`)},$=e=>{(typeof d.trace>"u"?!d.wasm.trace:!d.trace)||console.timeEnd(`ORT::${e}`)}}),ne=G(()=>{z(),te(),re(),P=class e{constructor(e){this.handler=e}async run(e,t,r){U(),R("InferenceSession.run");let n={},i={};if("object"!=typeof e||null===e||e instanceof I||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let a=!0;if("object"==typeof t){if(null===t)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof I)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(0===t.length)throw new TypeError("'fetches' cannot be an empty array.");a=!1;for(let e of t){if("string"!=typeof e)throw new TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(e))throw new RangeError(`'fetches' contains invalid output name: ${e}.`);n[e]=null}if("object"==typeof r&&null!==r)i=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{let e=!1,o=Object.getOwnPropertyNames(t);for(let r of this.outputNames)if(-1!==o.indexOf(r)){let i=t[r];(null===i||i instanceof I)&&(e=!0,a=!1,n[r]=i)}if(e){if("object"==typeof r&&null!==r)i=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else i=t}}else if(typeof t<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let t of this.inputNames)if(typeof e[t]>"u")throw new Error(`input '${t}' is missing in 'feeds'.`);if(a)for(let e of this.outputNames)n[e]=null;let o=await this.handler.run(e,n,i),s={};for(let e in o)if(Object.hasOwnProperty.call(o,e)){let t=o[e];s[e]=t instanceof I?t:new I(t.type,t.data,t.dims)}return $("InferenceSession.run"),M(),s}async release(){return this.handler.dispose()}static async create(t,r,n,i){U(),R("InferenceSession.create");let a,o={};if("string"==typeof t){if(a=t,"object"==typeof r&&null!==r)o=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(a=t,"object"==typeof r&&null!==r)o=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{if(!(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer))throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");{let e=t,s=0,l=t.byteLength;if("object"==typeof r&&null!==r)o=r;else if("number"==typeof r){if(s=r,!Number.isSafeInteger(s))throw new RangeError("'byteOffset' must be an integer.");if(s<0||s>=e.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${e.byteLength}).`);if(l=t.byteLength-s,"number"==typeof n){if(l=n,!Number.isSafeInteger(l))throw new RangeError("'byteLength' must be an integer.");if(l<=0||s+l>e.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${e.byteLength-s}].`);if("object"==typeof i&&null!==i)o=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof r<"u")throw new TypeError("'options' must be an object.");a=new Uint8Array(e,s,l)}}let[s,u]=await l(o),f=await s.createInferenceSessionHandler(a,u);return $("InferenceSession.create"),M(),new e(f)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),ie=G(()=>{ne(),j=P}),ae=G(()=>{}),oe=G(()=>{}),se=G(()=>{}),le=G(()=>{}),ue={};F(ue,{InferenceSession:()=>j,TRACE:()=>S,TRACE_EVENT_BEGIN:()=>R,TRACE_EVENT_END:()=>$,TRACE_FUNC_BEGIN:()=>U,TRACE_FUNC_END:()=>M,Tensor:()=>I,env:()=>c,registerBackend:()=>o});var fe=G(()=>{H(),Z(),ie(),te(),ae(),oe(),re(),se(),le()}),de=G(()=>{}),ce={};F(ce,{default:()=>ye});var pe,he,ye,me=G(()=>{xr(),Ut(),Bt(),pe="ort-wasm-proxy-worker",(he=globalThis.self?.name===pe)&&(self.onmessage=e=>{let{type:t,in:r}=e.data;try{switch(t){case"init-wasm":Ge(r.wasm).then(()=>{zt(r).then(()=>{postMessage({type:t})},e=>{postMessage({type:t,err:e})})},e=>{postMessage({type:t,err:e})});break;case"init-ep":{let{epName:e,env:n}=r;Ht(n,e).then(()=>{postMessage({type:t})},e=>{postMessage({type:t,err:e})});break}case"copy-from":{let{buffer:e}=r,n=Xt(e);postMessage({type:t,out:n});break}case"create":{let{model:e,options:n}=r;Qt(e,n).then(e=>{postMessage({type:t,out:e})},e=>{postMessage({type:t,err:e})});break}case"release":Kt(r),postMessage({type:t});break;case"run":{let{sessionId:e,inputIndices:n,inputs:i,outputIndices:a,options:o}=r;er(e,n,i,a,new Array(a.length).fill(null),o).then(e=>{e.some(e=>"cpu"!==e[3])?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:e},rr([...i,...e]))},e=>{postMessage({type:t,err:e})});break}case"end-profiling":tr(r),postMessage({type:t})}}catch(e){postMessage({type:t,err:e})}}),ye=he?null:e=>new Worker(e??Ee,{type:"module",name:pe})}),we={};F(we,{default:()=>be});var ge,be,ve,Ce,_e,Te,Ee,xe,Ae,Oe,Ie,Se,Be,Ue,Me,Re,$e,Pe,je,Le,ke,De,Ne,We,Ge,Fe,Ve,ze,He,qe,Ye,Ze,Xe,Qe,Ke,Je,et,tt,rt,nt,it,at,ot,st,lt,ut,ft,dt,ct,pt,ht,yt,mt,wt,gt,bt,vt,Ct,_t,Tt,Et,xt,At,Ot,It,St=G(()=>{ge=async function(e={}){var t,n,i=e,a=new Promise((e,r)=>{t=e,n=r}),o="object"==typeof window,s=typeof WorkerGlobalScope<"u",l=s&&self.name?.startsWith("em-pthread");i.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(i.fc||(i.fc=new Map)).set(e,t)},i.unmountExternalData=()=>{delete i.fc};var u=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,ld:!0}).buffer.constructor;let f=()=>{let e=(e,t,r)=>(...n)=>{let i=Lt,a=t?.();n=e(...n);let o=t?.();return a!==o&&(e=o,r(a),t=r=null),Lt!=i?new Promise((e,t)=>{Ft={resolve:e,reject:t}}):n};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])i[t]=e(i[t],()=>i[t],e=>i[t]=e)})(),typeof jsepRunAsync<"u"&&(i._OrtRun=jsepRunAsync(i._OrtRun),i._OrtRunWithBinding=jsepRunAsync(i._OrtRunWithBinding)),f=void 0};i.asyncInit=()=>{f?.()};var d,c,p=(e,t)=>{throw t},h="";if(o||s){try{h=new URL(".","file:///D:/5650HightPerfprmance/WebGPU-Video-Diffusion/node_modules/onnxruntime-web/dist/ort.webgpu.bundle.min.mjs").href}catch{}s&&(c=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),d=async e=>{if(P(e))return new Promise((t,r)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?t(n.response):r(n.status)},n.onerror=r,n.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var y,m,w,g,b,v,C,_,T,E,x,A,O,I,S,B=console.log.bind(console),U=console.error.bind(console),M=B,R=U,$=!1,P=e=>e.startsWith("file://");function j(){return m.buffer!=b.buffer&&z(),b}function L(){return m.buffer!=b.buffer&&z(),v}function k(){return m.buffer!=b.buffer&&z(),C}function D(){return m.buffer!=b.buffer&&z(),_}function N(){return m.buffer!=b.buffer&&z(),T}function W(){return m.buffer!=b.buffer&&z(),E}function G(){return m.buffer!=b.buffer&&z(),x}function F(){return m.buffer!=b.buffer&&z(),I}if(l){let e=function(t){try{var r=t.data,n=r.dc;if("load"===n){let t=[];self.onmessage=e=>t.push(e),self.startWorker=()=>{postMessage({dc:"loaded"});for(let r of t)e(r);self.onmessage=e};for(let e of r.Uc)i[e]&&!i[e].proxy||(i[e]=(...t)=>{postMessage({dc:"callHandler",Tc:e,args:t})},"print"==e&&(M=i[e]),"printErr"==e&&(R=i[e]));m=r.bd,z(),S(r.cd)}else if("run"===n){me(r.ac),ji(r.ac,0,0,1,0,0),pe(),Tt(r.ac),V||(pi(),V=!0);try{we(r.Zc,r.jc)}catch(e){if("unwind"!=e)throw e}}else"setimmediate"!==r.target&&("checkMailbox"===n?V&&Et():n&&(R(`worker: received unknown command ${n}`),R(r)))}catch(e){throw Li(),e}};var V=!1;self.onunhandledrejection=e=>{throw e.reason||e},self.onmessage=e}function z(){var e=m.buffer;i.HEAP8=b=new Int8Array(e),C=new Int16Array(e),i.HEAPU8=v=new Uint8Array(e),_=new Uint16Array(e),i.HEAP32=T=new Int32Array(e),i.HEAPU32=E=new Uint32Array(e),x=new Float32Array(e),I=new Float64Array(e),A=new BigInt64Array(e),O=new BigUint64Array(e)}function H(){l?startWorker(i):di.nb()}var q,Y=0,Z=null;function X(){if(0==--Y&&Z){var e=Z;Z=null,e()}}function Q(e){throw R(e="Aborted("+e+")"),$=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),n(e),e}function K(){return{a:{R:fi,b:ve,ba:_e,I:Ae,ra:Oe,jb:Ie,lb:Se,sa:Be,pa:Ue,ia:Me,oa:Re,P:$e,kb:Pe,hb:je,qa:Le,ib:ke,xa:Ne,Z:Ye,cb:Xe,ab:it,Y:ot,w:st,t:lt,bb:dt,L:bt,db:vt,la:Ct,fb:xt,ca:Ot,_a:It,$:St,ka:Tt,ua:Bt,s:Rt,Na:$t,A:Ht,o:Yt,m:Qt,c:Je,Ma:Kt,n:er,i:nr,v:ir,p:ar,f:or,u:sr,k:lr,e:ur,j:fr,h:dr,g:cr,d:pr,fa:hr,ga:gr,ha:br,da:vr,ea:Cr,$a:Er,za:xr,wa:Ir,E:Ur,La:Mr,M:Rr,va:Ar,C:$r,ta:Pr,gb:jr,r:Tr,Ia:Lr,F:kr,Q:Dr,eb:Nr,Ba:Vr,Aa:zr,Ha:dn,q:cn,U:hn,T:yn,Ka:mn,D:wn,l:gn,Ga:bn,Fa:vn,Ja:Cn,Ea:_n,Da:Tn,Ca:En,ma:In,na:Sn,aa:se,J:Bn,O:Un,ja:Mn,N:$n,a:m,ya:ae,Xa:Pn,K:jn,x:Ln,S:kn,Ya:Dn,y:Nn,Ta:Wn,Va:Gn,V:Fn,z:Vn,_:zn,W:Hn,G:qn,Ra:Yn,mb:Zn,B:Xn,Ua:Qn,Wa:Kn,Oa:Jn,Pa:ei,Qa:ti,H:ri,X:ni,Sa:ii,Za:ai}}}class J{name="ExitStatus";constructor(e){this.message=`Program terminated with exit(${e})`,this.status=e}}var ee=e=>{e.terminate(),e.onmessage=()=>{}},te=[],re=e=>{0==le.length&&(ye(),he(le[0]));var t=le.pop();if(!t)return 6;ue.push(t),de[e.ac]=t,t.ac=e.ac;var r={dc:"run",Zc:e.Yc,jc:e.jc,ac:e.ac};return t.postMessage(r,e.Oc),0},ne=0,ie=(e,t,...r)=>{for(var n=2*r.length,i=qi(),a=Hi(8*n),o=a>>>3,s=0;s<r.length;s++){var l=r[s];"bigint"==typeof l?(A[o+2*s]=1n,A[o+2*s+1]=l):(A[o+2*s]=0n,F()[o+2*s+1>>>0]=l)}return e=ki(e,0,n,a,t),zi(i),e};function ae(e){if(l)return ie(0,1,e);if(g=e,!(0<ne)){for(var t of ue)ee(t);for(t of le)ee(t);le=[],ue=[],de={},$=!0}p(0,new J(e))}function oe(e){if(l)return ie(1,0,e);se(e)}var se=e=>{if(g=e,l)throw oe(e),"unwind";ae(e)},le=[],ue=[],fe=[],de={},ce=e=>{var t=e.ac;delete de[t],le.push(e),ue.splice(ue.indexOf(e),1),e.ac=0,Di(t)};function pe(){fe.forEach(e=>e())}var he=e=>new Promise(t=>{e.onmessage=r=>{var n=(r=r.data).dc;if(r.hc&&r.hc!=yi()){var a=de[r.hc];a?a.postMessage(r,r.Oc):R(`Internal error! Worker sent a message "${n}" to target pthread ${r.hc}, but that thread no longer exists!`)}else"checkMailbox"===n?Et():"spawnThread"===n?re(r):"cleanupThread"===n?ce(de[r.$c]):"loaded"===n?(e.loaded=!0,t(e)):"setimmediate"===r.target?e.postMessage(r):"callHandler"===n?i[r.Tc](...r.args):n&&R(`worker sent an unknown command ${n}`)},e.onerror=e=>{throw R(`worker sent an error! ${e.filename}:${e.lineno}: ${e.message}`),e};var r,n=[];for(r of[])i.propertyIsEnumerable(r)&&n.push(r);e.postMessage({dc:"load",Uc:n,bd:m,cd:w})});function ye(){var e=new Worker(new URL(r(/*! ort.webgpu.bundle.min.mjs */"./node_modules/onnxruntime-web/dist/ort.webgpu.bundle.min.mjs?3e05"),r.b),{type:"module",workerData:"em-pthread",name:"em-pthread"});le.push(e)}var me=e=>{z();var t=W()[e+52>>>2>>>0];e=W()[e+56>>>2>>>0],Vi(t,t-e),zi(t)},we=(e,t)=>{ne=0,e=Yi(e,t),0<ne?g=e:Ni(e)};class ge{constructor(e){this.ic=e-24}}var be=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e);function ve(e,t,r){var n=new ge(e>>>=0);throw t>>>=0,r>>>=0,W()[n.ic+16>>>2>>>0]=0,W()[n.ic+4>>>2>>>0]=t,W()[n.ic+8>>>2>>>0]=r,e}function Ce(e,t,r,n){return l?ie(2,1,e,t,r,n):_e(e,t,r,n)}function _e(e,t,r,n){if(e>>>=0,r>>>=0,n>>>=0,void 0===u)return 6;var i=[];return l&&0===i.length?Ce(e,t>>>=0,r,n):(e={Yc:r,ac:e,jc:n,Oc:i},l?(e.dc="spawnThread",postMessage(e,i),0):re(e))}var Te=typeof TextDecoder<"u"?new TextDecoder:void 0,Ee=(e,t=0,r=NaN)=>{var n=(t>>>=0)+r;for(r=t;e[r]&&!(r>=n);)++r;if(16<r-t&&e.buffer&&Te)return Te.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,r):e.slice(t,r));for(n="";t<r;){var i=e[t++];if(128&i){var a=63&e[t++];if(192==(224&i))n+=String.fromCharCode((31&i)<<6|a);else{var o=63&e[t++];65536>(i=224==(240&i)?(15&i)<<12|a<<6|o:(7&i)<<18|a<<12|o<<6|63&e[t++])?n+=String.fromCharCode(i):(i-=65536,n+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else n+=String.fromCharCode(i)}return n},xe=(e,t)=>(e>>>=0)?Ee(L(),e,t):"";function Ae(e,t,r){return l?ie(3,1,e,t,r):0}function Oe(e,t){if(l)return ie(4,1,e,t)}function Ie(e,t){if(l)return ie(5,1,e,t)}function Se(e,t,r){if(l)return ie(6,1,e,t,r)}function Be(e,t,r){return l?ie(7,1,e,t,r):0}function Ue(e,t){if(l)return ie(8,1,e,t)}function Me(e,t,r){if(l)return ie(9,1,e,t,r)}function Re(e,t,r,n){if(l)return ie(10,1,e,t,r,n)}function $e(e,t,r,n){if(l)return ie(11,1,e,t,r,n)}function Pe(e,t,r,n){if(l)return ie(12,1,e,t,r,n)}function je(e){if(l)return ie(13,1,e)}function Le(e,t){if(l)return ie(14,1,e,t)}function ke(e,t,r){if(l)return ie(15,1,e,t,r)}var De,Ne=()=>Q(""),We=e=>{for(var t="";L()[e>>>0];)t+=De[L()[e++>>>0]];return t},Ge={},Fe={},Ve={},ze=i.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}};function He(e,t,r={}){return function(e,t,r={}){var n=t.name;if(!e)throw new ze(`type "${n}" must have a positive integer typeid pointer`);if(Fe.hasOwnProperty(e)){if(r.Vc)return;throw new ze(`Cannot register type '${n}' twice`)}Fe[e]=t,delete Ve[e],Ge.hasOwnProperty(e)&&(t=Ge[e],delete Ge[e],t.forEach(e=>e()))}(e,t,r)}var qe=(e,t,r)=>{switch(t){case 1:return r?e=>j()[e>>>0]:e=>L()[e>>>0];case 2:return r?e=>k()[e>>>1>>>0]:e=>D()[e>>>1>>>0];case 4:return r?e=>N()[e>>>2>>>0]:e=>W()[e>>>2>>>0];case 8:return r?e=>A[e>>>3]:e=>O[e>>>3];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function Ye(e,t,r){r>>>=0,He(e>>>=0,{name:t=We(t>>>0),fromWireType:e=>e,toWireType:function(e,t){if("bigint"!=typeof t&&"number"!=typeof t)throw t=null===t?"null":"object"==(e=typeof t)||"array"===e||"function"===e?t.toString():""+t,new TypeError(`Cannot convert "${t}" to ${this.name}`);return"number"==typeof t&&(t=BigInt(t)),t},cc:Ze,readValueFromPointer:qe(t,r,-1==t.indexOf("u")),ec:null})}var Ze=8;function Xe(e,t,r,n){He(e>>>=0,{name:t=We(t>>>0),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:n},cc:Ze,readValueFromPointer:function(e){return this.fromWireType(L()[e>>>0])},ec:null})}var Qe=[],Ke=[];function Je(e){9<(e>>>=0)&&0==--Ke[e+1]&&(Ke[e]=void 0,Qe.push(e))}var et=e=>{if(!e)throw new ze(`Cannot use deleted val. handle = ${e}`);return Ke[e]},tt=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=Qe.pop()||Ke.length;return Ke[t]=e,Ke[t+1]=1,t}};function rt(e){return this.fromWireType(W()[e>>>2>>>0])}var nt={name:"emscripten::val",fromWireType:e=>{var t=et(e);return Je(e),t},toWireType:(e,t)=>tt(t),cc:Ze,readValueFromPointer:rt,ec:null};function it(e){return He(e>>>0,nt)}var at=(e,t)=>{switch(t){case 4:return function(e){return this.fromWireType(G()[e>>>2>>>0])};case 8:return function(e){return this.fromWireType(F()[e>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function ot(e,t,r){r>>>=0,He(e>>>=0,{name:t=We(t>>>0),fromWireType:e=>e,toWireType:(e,t)=>t,cc:Ze,readValueFromPointer:at(t,r),ec:null})}function st(e,t,r,n,i){if(e>>>=0,r>>>=0,t=We(t>>>0),-1===i&&(i=4294967295),i=e=>e,0===n){var a=32-8*r;i=e=>e<<a>>>a}var o=t.includes("unsigned")?function(e,t){return t>>>0}:function(e,t){return t};He(e,{name:t,fromWireType:i,toWireType:o,cc:Ze,readValueFromPointer:qe(t,r,0!==n),ec:null})}function lt(e,t,r){function n(e){var t=W()[e>>>2>>>0];return e=W()[e+4>>>2>>>0],new i(j().buffer,e,t)}var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];He(e>>>=0,{name:r=We(r>>>0),fromWireType:n,cc:Ze,readValueFromPointer:n},{Vc:!0})}var ut=(e,t,r)=>{var n=L();if(t>>>=0,0<r){var i=t;r=t+r-1;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),127>=o){if(t>=r)break;n[t++>>>0]=o}else{if(2047>=o){if(t+1>=r)break;n[t++>>>0]=192|o>>6}else{if(65535>=o){if(t+2>=r)break;n[t++>>>0]=224|o>>12}else{if(t+3>=r)break;n[t++>>>0]=240|o>>18,n[t++>>>0]=128|o>>12&63}n[t++>>>0]=128|o>>6&63}n[t++>>>0]=128|63&o}}n[t>>>0]=0,e=t-i}else e=0;return e},ft=e=>{for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);127>=n?t++:2047>=n?t+=2:55296<=n&&57343>=n?(t+=4,++r):t+=3}return t};function dt(e,t){He(e>>>=0,{name:t=We(t>>>0),fromWireType:function(e){for(var t,r=W()[e>>>2>>>0],n=e+4,i=n,a=0;a<=r;++a){var o=n+a;a!=r&&0!=L()[o>>>0]||(i=xe(i,o-i),void 0===t?t=i:(t+="\0",t+=i),i=o+1)}return mi(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;if(!(r||ArrayBuffer.isView(t)&&1==t.BYTES_PER_ELEMENT))throw new ze("Cannot pass non-string to std::string");var n=r?ft(t):t.length,i=wi(4+n+1),a=i+4;return W()[i>>>2>>>0]=n,r?ut(t,a,n+1):L().set(t,a>>>0),null!==e&&e.push(mi,i),i},cc:Ze,readValueFromPointer:rt,ec(e){mi(e)}})}var ct=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,pt=(e,t)=>{for(var r=e>>1,n=r+t/2;!(r>=n)&&D()[r>>>0];)++r;if(32<(r<<=1)-e&&ct)return ct.decode(L().slice(e,r));for(r="",n=0;!(n>=t/2);++n){var i=k()[e+2*n>>>1>>>0];if(0==i)break;r+=String.fromCharCode(i)}return r},ht=(e,t,r)=>{if(r??=2147483647,2>r)return 0;var n=t;r=(r-=2)<2*e.length?r/2:e.length;for(var i=0;i<r;++i){var a=e.charCodeAt(i);k()[t>>>1>>>0]=a,t+=2}return k()[t>>>1>>>0]=0,t-n},yt=e=>2*e.length,mt=(e,t)=>{for(var r=0,n="";!(r>=t/4);){var i=N()[e+4*r>>>2>>>0];if(0==i)break;++r,65536<=i?(i-=65536,n+=String.fromCharCode(55296|i>>10,56320|1023&i)):n+=String.fromCharCode(i)}return n},wt=(e,t,r)=>{if(t>>>=0,r??=2147483647,4>r)return 0;var n=t;r=n+r-4;for(var i=0;i<e.length;++i){var a=e.charCodeAt(i);if(55296<=a&&57343>=a&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++i)),N()[t>>>2>>>0]=a,(t+=4)+4>r)break}return N()[t>>>2>>>0]=0,t-n},gt=e=>{for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);55296<=n&&57343>=n&&++r,t+=4}return t};function bt(e,t,r){if(e>>>=0,t>>>=0,r=We(r>>>=0),2===t)var n=pt,i=ht,a=yt,o=e=>D()[e>>>1>>>0];else 4===t&&(n=mt,i=wt,a=gt,o=e=>W()[e>>>2>>>0]);He(e,{name:r,fromWireType:e=>{for(var r,i=W()[e>>>2>>>0],a=e+4,s=0;s<=i;++s){var l=e+4+s*t;s!=i&&0!=o(l)||(a=n(a,l-a),void 0===r?r=a:(r+="\0",r+=a),a=l+t)}return mi(e),r},toWireType:(e,n)=>{if("string"!=typeof n)throw new ze(`Cannot pass non-string to C++ string type ${r}`);var o=a(n),s=wi(4+o+t);return W()[s>>>2>>>0]=o/t,i(n,s+4,o+t),null!==e&&e.push(mi,s),s},cc:Ze,readValueFromPointer:rt,ec(e){mi(e)}})}function vt(e,t){He(e>>>=0,{Wc:!0,name:t=We(t>>>0),cc:0,fromWireType:()=>{},toWireType:()=>{}})}function Ct(e){ji(e>>>0,!s,1,!o,131072,!1),pe()}var _t=e=>{if(!$)try{if(e(),!(0<ne))try{l?Ni(g):se(g)}catch(e){e instanceof J||"unwind"==e||p(0,e)}}catch(e){e instanceof J||"unwind"==e||p(0,e)}};function Tt(e){e>>>=0,"function"==typeof Atomics.ad&&(Atomics.ad(N(),e>>>2,e).value.then(Et),e+=128,Atomics.store(N(),e>>>2,1))}var Et=()=>{var e=yi();e&&(Tt(e),_t(Gi))};function xt(e,t){(e>>>=0)==t>>>0?setTimeout(Et):l?postMessage({hc:e,dc:"checkMailbox"}):(e=de[e])&&e.postMessage({dc:"checkMailbox"})}var At=[];function Ot(e,t,r,n,i){for(t>>>=0,n/=2,At.length=n,r=i>>>0>>>3,i=0;i<n;i++)At[i]=A[r+2*i]?A[r+2*i+1]:F()[r+2*i+1>>>0];return(t?ui[t]:li[e])(...At)}var It=()=>{ne=0};function St(e){e>>>=0,l?postMessage({dc:"cleanupThread",$c:e}):ce(de[e])}function Bt(e){}var Ut=(e,t)=>{var r=Fe[e];if(void 0===r)throw e=ci(e),r=We(e),mi(e),new ze(`${t} has unknown type ${r}`);return r},Mt=(e,t,r)=>{var n=[];return e=e.toWireType(n,r),n.length&&(W()[t>>>2>>>0]=tt(n)),e};function Rt(e,t,r){return t>>>=0,r>>>=0,e=et(e>>>0),t=Ut(t,"emval::as"),Mt(t,r,e)}function $t(e,t){return t>>>=0,e=et(e>>>0),(t=Ut(t,"emval::as")).toWireType(null,e)}var Pt=e=>{try{e()}catch(e){Q(e)}},jt=0,Lt=null,kt=0,Dt=[],Nt={},Wt={},Gt=0,Ft=null,Vt=[];function zt(e){return function(){if(!$){if(0===jt){var t=!1,r=!1;(t=>{e().then(t)})((e=0)=>{if(!$&&(kt=e,t=!0,r)){jt=2,Pt(()=>Qi(Lt)),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.resume(),e=!1;try{var n=(o=N()[Lt+8>>>2>>>0],o=di[Wt[o]],--ne,o())}catch(o){n=o,e=!0}var i=!1;if(!Lt){var a=Ft;a&&(Ft=null,(e?a.reject:a.resolve)(n),i=!0)}if(e&&!i)throw n}var o}),r=!0,t||(jt=1,Lt=function(){var e=wi(65548),t=e+12;W()[e>>>2>>>0]=t,W()[e+4>>>2>>>0]=t+65536,t=Dt[0];var r=Nt[t];return void 0===r&&(r=Gt++,Nt[t]=r,Wt[r]=t),t=r,N()[e+8>>>2>>>0]=t,e}(),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.pause(),Pt(()=>Zi(Lt)))}else 2===jt?(jt=0,Pt(Ki),mi(Lt),Lt=null,Vt.forEach(_t)):Q(`invalid state: ${jt}`);return kt}}()}function Ht(e){return e>>>=0,zt(async()=>{var t=await et(e);return tt(t)})}var qt=[];function Yt(e,t,r,n){return r>>>=0,n>>>=0,(e=qt[e>>>0])(null,t=et(t>>>0),r,n)}var Zt={},Xt=e=>{var t=Zt[e];return void 0===t?We(e):t};function Qt(e,t,r,n,i){return r>>>=0,n>>>=0,i>>>=0,(e=qt[e>>>0])(t=et(t>>>0),t[r=Xt(r)],n,i)}function Kt(e,t){return t>>>=0,(e=et(e>>>0))==et(t)}var Jt=()=>"object"==typeof globalThis?globalThis:Function("return this")();function er(e){return 0==(e>>>=0)?tt(Jt()):(e=Xt(e),tt(Jt()[e]))}var tr=e=>{var t=qt.length;return qt.push(e),t},rr=(e,t)=>{for(var r=Array(e),n=0;n<e;++n)r[n]=Ut(W()[t+4*n>>>2>>>0],`parameter ${n}`);return r};function nr(e,t,r){var n=(t=rr(e,t>>>0)).shift();e--;var i="return function (obj, func, destructorsRef, args) {\n",a=0,o=[];0===r&&o.push("obj");for(var s=["retType"],l=[n],u=0;u<e;++u)o.push(`arg${u}`),s.push(`argType${u}`),l.push(t[u]),i+=`  var arg${u} = argType${u}.readValueFromPointer(args${a?"+"+a:""});\n`,a+=t[u].cc;return i+=`  var rv = ${1===r?"new func":"func.call"}(${o.join(", ")});\n`,n.Wc||(s.push("emval_returnValue"),l.push(Mt),i+="  return emval_returnValue(retType, destructorsRef, rv);\n"),e=new Function(...s,i+"};\n")(...l),r=`methodCaller<(${t.map(e=>e.name).join(", ")}) => ${n.name}>`,tr(Object.defineProperty(e,"name",{value:r}))}function ir(e){return e=Xt(e>>>0),tt(i[e])}function ar(e,t){return t>>>=0,e=et(e>>>0),t=et(t),tt(e[t])}function or(e){9<(e>>>=0)&&(Ke[e+1]+=1)}function sr(){return tt([])}function lr(e){e=et(e>>>0);for(var t=Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return tt(t)}function ur(e){return tt(Xt(e>>>0))}function fr(){return tt({})}function dr(e){for(var t=et(e>>>=0);t.length;){var r=t.pop();t.pop()(r)}Je(e)}function cr(e,t,r){t>>>=0,r>>>=0,e=et(e>>>0),t=et(t),r=et(r),e[t]=r}function pr(e,t){return t>>>=0,e=(e=Ut(e>>>0,"_emval_take_value")).readValueFromPointer(t),tt(e)}function hr(e,t){e=be(e),t>>>=0,e=new Date(1e3*e),N()[t>>>2>>>0]=e.getUTCSeconds(),N()[t+4>>>2>>>0]=e.getUTCMinutes(),N()[t+8>>>2>>>0]=e.getUTCHours(),N()[t+12>>>2>>>0]=e.getUTCDate(),N()[t+16>>>2>>>0]=e.getUTCMonth(),N()[t+20>>>2>>>0]=e.getUTCFullYear()-1900,N()[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,N()[t+28>>>2>>>0]=e}var yr=e=>e%4==0&&(e%100!=0||e%400==0),mr=[0,31,60,91,121,152,182,213,244,274,305,335],wr=[0,31,59,90,120,151,181,212,243,273,304,334];function gr(e,t){e=be(e),t>>>=0,e=new Date(1e3*e),N()[t>>>2>>>0]=e.getSeconds(),N()[t+4>>>2>>>0]=e.getMinutes(),N()[t+8>>>2>>>0]=e.getHours(),N()[t+12>>>2>>>0]=e.getDate(),N()[t+16>>>2>>>0]=e.getMonth(),N()[t+20>>>2>>>0]=e.getFullYear()-1900,N()[t+24>>>2>>>0]=e.getDay();var r=(yr(e.getFullYear())?mr:wr)[e.getMonth()]+e.getDate()-1|0;N()[t+28>>>2>>>0]=r,N()[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),r=new Date(e.getFullYear(),6,1).getTimezoneOffset();var n=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(r!=n&&e.getTimezoneOffset()==Math.min(n,r)),N()[t+32>>>2>>>0]=e}function br(e){e>>>=0;var t=new Date(N()[e+20>>>2>>>0]+1900,N()[e+16>>>2>>>0],N()[e+12>>>2>>>0],N()[e+8>>>2>>>0],N()[e+4>>>2>>>0],N()[e>>>2>>>0],0),r=N()[e+32>>>2>>>0],n=t.getTimezoneOffset(),i=new Date(t.getFullYear(),6,1).getTimezoneOffset(),a=new Date(t.getFullYear(),0,1).getTimezoneOffset(),o=Math.min(a,i);return 0>r?N()[e+32>>>2>>>0]=+(i!=a&&o==n):0<r!=(o==n)&&(i=Math.max(a,i),t.setTime(t.getTime()+6e4*((0<r?o:i)-n))),N()[e+24>>>2>>>0]=t.getDay(),r=(yr(t.getFullYear())?mr:wr)[t.getMonth()]+t.getDate()-1|0,N()[e+28>>>2>>>0]=r,N()[e>>>2>>>0]=t.getSeconds(),N()[e+4>>>2>>>0]=t.getMinutes(),N()[e+8>>>2>>>0]=t.getHours(),N()[e+12>>>2>>>0]=t.getDate(),N()[e+16>>>2>>>0]=t.getMonth(),N()[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function vr(e,t,r,n,i,a,o){return l?ie(16,1,e,t,r,n,i,a,o):-52}function Cr(e,t,r,n,i,a){if(l)return ie(17,1,e,t,r,n,i,a)}var _r={},Tr=()=>performance.timeOrigin+performance.now();function Er(e,t){if(l)return ie(18,1,e,t);if(_r[e]&&(clearTimeout(_r[e].id),delete _r[e]),!t)return 0;var r=setTimeout(()=>{delete _r[e],_t(()=>Wi(e,performance.timeOrigin+performance.now()))},t);return _r[e]={id:r,nd:t},0}function xr(e,t,r,n){e>>>=0,t>>>=0,r>>>=0,n>>>=0;var i=(new Date).getFullYear(),a=new Date(i,0,1).getTimezoneOffset();i=new Date(i,6,1).getTimezoneOffset();var o=Math.max(a,i);W()[e>>>2>>>0]=60*o,N()[t>>>2>>>0]=+(a!=i),e=(t=e=>{var t=Math.abs(e);return`UTC${0<=e?"-":"+"}${String(Math.floor(t/60)).padStart(2,"0")}${String(t%60).padStart(2,"0")}`})(a),t=t(i),i<a?(ut(e,r,17),ut(t,n,17)):(ut(e,n,17),ut(t,r,17))}var Ar=()=>Date.now(),Or=1;function Ir(e,t,r){if(!(0<=e&&3>=e))return 28;if(0===e)e=Date.now();else{if(!Or)return 52;e=performance.timeOrigin+performance.now()}return A[r>>>0>>>3]=BigInt(Math.round(1e6*e)),0}var Sr=[],Br=(e,t)=>{Sr.length=0;for(var r;r=L()[e++>>>0];){var n=105!=r;t+=(n&=112!=r)&&t%8?4:0,Sr.push(112==r?W()[t>>>2>>>0]:106==r?A[t>>>3]:105==r?N()[t>>>2>>>0]:F()[t>>>3>>>0]),t+=n?8:4}return Sr};function Ur(e,t,r){return e>>>=0,t=Br(t>>>0,r>>>0),ui[e](...t)}function Mr(e,t,r){return e>>>=0,t=Br(t>>>0,r>>>0),ui[e](...t)}var Rr=()=>{};function $r(e,t){return R(xe(e>>>0,t>>>0))}var Pr=()=>{throw ne+=1,"unwind"};function jr(){return 4294901760}var Lr=()=>1,kr=()=>navigator.hardwareConcurrency;function Dr(){return Q("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Nr(e){e>>>=0;var t=L().length;if(e<=t||4294901760<e)return!1;for(var r=1;4>=r;r*=2){var n=t*(1+.2/r);n=Math.min(n,e+100663296);e:{n=(Math.min(4294901760,65536*Math.ceil(Math.max(e,n)/65536))-m.buffer.byteLength+65535)/65536|0;try{m.grow(n),z();var i=1;break e}catch{}i=void 0}if(i)return!0}return!1}var Wr=()=>(Q("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Gr={},Fr=e=>{e.forEach(e=>{var t=Wr();t&&(Gr[t]=e)})};function Vr(){var e=Error().stack.toString().split("\n");return"Error"==e[0]&&e.shift(),Fr(e),Gr.oc=Wr(),Gr.Xc=e,Gr.oc}function zr(e,t,r){if(e>>>=0,t>>>=0,Gr.oc==e)var n=Gr.Xc;else"Error"==(n=Error().stack.toString().split("\n"))[0]&&n.shift(),Fr(n);for(var i=3;n[i]&&Wr()!=e;)++i;for(e=0;e<r&&n[e+i];++e)N()[t+4*e>>>2>>>0]=Wr();return e}var Hr=e=>{var t=ft(e)+1,r=Hi(t);return ut(e,r,t),r},qr=[],Yr=(e,t)=>{qr[e>>>=0]=t},Zr=[],Xr=[],Qr=(e,t)=>{Xr[e]=new Promise(r=>t.finally(()=>r(e)))},Kr=e=>{if(e)return qr[e>>>0]},Jr=(e,t,r)=>{W()[e>>>2>>>0]=t,W()[e+4>>>2>>>0]=r},en=e=>{var t=W()[e>>>2>>>0];return e=W()[e+4>>>2>>>0],xe(t,e)},tn=e=>{var t=W()[e>>>2>>>0];return e=W()[e+4>>>2>>>0],t?xe(t,e):0===e?"":void 0},rn=(e,t)=>{function r(r,n){r=e[r],N()[t+n>>>2>>>0]=r}function n(r,n){A[t+n>>>3]=BigInt(e[r])}r("maxTextureDimension1D",4),r("maxTextureDimension2D",8),r("maxTextureDimension3D",12),r("maxTextureArrayLayers",16),r("maxBindGroups",20),r("maxBindGroupsPlusVertexBuffers",24),r("maxBindingsPerBindGroup",28),r("maxDynamicUniformBuffersPerPipelineLayout",32),r("maxDynamicStorageBuffersPerPipelineLayout",36),r("maxSampledTexturesPerShaderStage",40),r("maxSamplersPerShaderStage",44),r("maxStorageBuffersPerShaderStage",48),r("maxStorageTexturesPerShaderStage",52),r("maxUniformBuffersPerShaderStage",56),r("minUniformBufferOffsetAlignment",80),r("minStorageBufferOffsetAlignment",84),n("maxUniformBufferBindingSize",64),n("maxStorageBufferBindingSize",72),r("maxVertexBuffers",88),n("maxBufferSize",96),r("maxVertexAttributes",104),r("maxVertexBufferArrayStride",108),r("maxInterStageShaderVariables",112),r("maxColorAttachments",116),r("maxColorAttachmentBytesPerSample",120),r("maxComputeWorkgroupStorageSize",124),r("maxComputeInvocationsPerWorkgroup",128),r("maxComputeWorkgroupSizeX",132),r("maxComputeWorkgroupSizeY",136),r("maxComputeWorkgroupSizeZ",140),r("maxComputeWorkgroupsPerDimension",144),void 0!==e.kd&&r("maxImmediateSize",148)},nn={undefined:1,pd:1,gd:2},an={1:"validation",2:"out-of-memory",3:"internal"},on=[,"compatibility","core"],sn={1:"depth-clip-control",2:"depth32float-stencil8",3:"timestamp-query",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"indirect-first-instance",10:"shader-f16",11:"rg11b10ufloat-renderable",12:"bgra8unorm-storage",13:"float32-filterable",14:"float32-blendable",15:"clip-distances",16:"dual-source-blending",17:"subgroups",18:"core-features-and-limits",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},ln=[,"low-power","high-performance"],un={1:"occlusion",2:"timestamp"},fn={"depth-clip-control":"1","depth32float-stencil8":"2","timestamp-query":"3","texture-compression-bc":"4","texture-compression-bc-sliced-3d":"5","texture-compression-etc2":"6","texture-compression-astc":"7","texture-compression-astc-sliced-3d":"8","indirect-first-instance":"9","shader-f16":"10","rg11b10ufloat-renderable":"11","bgra8unorm-storage":"12","float32-filterable":"13","float32-blendable":"14","clip-distances":"15","dual-source-blending":"16",md:"17","core-features-and-limits":"18","chromium-experimental-unorm16-texture-formats":"327692","chromium-experimental-snorm16-texture-formats":"327693","chromium-experimental-multi-draw-indirect":"327732"};function dn(e,t,r,n,i,a){t=be(t),r=be(r),n>>>=0,i>>>=0,a>>>=0,e=Kr(e>>>0);var o={};if(a){var s=W()[a+12>>>2>>>0];if(s){var l=W()[a+16>>>2>>>0];o.requiredFeatures=Array.from(W().subarray(l>>>2>>>0,l+4*s>>>2>>>0),e=>sn[e])}var u=W()[a+20>>>2>>>0];if(u){let e=function(e,t,r=!1){t=u+t,4294967295==(t=W()[t>>>2>>>0])||r&&0==t||(f[e]=t)},t=function(e,t){t=u+t;var r=W()[t>>>2>>>0],n=W()[t+4>>>2>>>0];4294967295==r&&4294967295==n||(f[e]=4294967296*W()[t+4>>>2>>>0]+W()[t>>>2>>>0])};var f={};e("maxTextureDimension1D",4),e("maxTextureDimension2D",8),e("maxTextureDimension3D",12),e("maxTextureArrayLayers",16),e("maxBindGroups",20),e("maxBindGroupsPlusVertexBuffers",24),e("maxDynamicUniformBuffersPerPipelineLayout",32),e("maxDynamicStorageBuffersPerPipelineLayout",36),e("maxSampledTexturesPerShaderStage",40),e("maxSamplersPerShaderStage",44),e("maxStorageBuffersPerShaderStage",48),e("maxStorageTexturesPerShaderStage",52),e("maxUniformBuffersPerShaderStage",56),e("minUniformBufferOffsetAlignment",80),e("minStorageBufferOffsetAlignment",84),t("maxUniformBufferBindingSize",64),t("maxStorageBufferBindingSize",72),e("maxVertexBuffers",88),t("maxBufferSize",96),e("maxVertexAttributes",104),e("maxVertexBufferArrayStride",108),e("maxInterStageShaderVariables",112),e("maxColorAttachments",116),e("maxColorAttachmentBytesPerSample",120),e("maxComputeWorkgroupStorageSize",124),e("maxComputeInvocationsPerWorkgroup",128),e("maxComputeWorkgroupSizeX",132),e("maxComputeWorkgroupSizeY",136),e("maxComputeWorkgroupSizeZ",140),e("maxComputeWorkgroupsPerDimension",144),e("maxImmediateSize",148,!0),o.requiredLimits=f}(s=W()[a+24>>>2>>>0])&&(s={label:tn(s+4)},o.defaultQueue=s),o.label=tn(a+4)}ne+=1,Qr(t,e.requestDevice(o).then(e=>{--ne,Yr(i,e.queue),Yr(n,e),r&&(ne+=1,Qr(r,e.lost.then(t=>{--ne,e.onuncapturederror=()=>{};var n=qi(),i=Hr(t.message);Bi(r,nn[t.reason],i),zi(n)}))),e.onuncapturederror=e=>{var t=5;e.error instanceof GPUValidationError?t=2:e.error instanceof GPUOutOfMemoryError?t=3:e.error instanceof GPUInternalError&&(t=4);var r=qi();e=Hr(e.error.message),Pi(n,t,e),zi(r)},$i(t,1,n,0)},e=>{--ne;var i=qi();e=Hr(e.message),$i(t,3,n,e),r&&Bi(r,4,e),zi(i)}))}function cn(e){var t=Kr(e>>>=0),r=Zr[e];if(r){for(var n=0;n<r.length;++n)r[n]();delete Zr[e]}t.destroy()}var pn=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";pn.kc||(pn.kc={}),pn.kc[e]||(pn.kc[e]=1,R(e))};function hn(e,t,r){t>>>=0,r>>>=0;var n=Kr(e>>>=0);0===r&&pn(),4294967295==r&&(r=void 0);try{var i=n.getMappedRange(t,r)}catch{return 0}var a=Fi(16,i.byteLength);return L().set(new Uint8Array(i),a>>>0),Zr[e].push(()=>mi(a)),a}function yn(e,t,r){t>>>=0,r>>>=0;var n=Kr(e>>>=0);0===r&&pn(),4294967295==r&&(r=void 0);try{var i=n.getMappedRange(t,r)}catch{return 0}var a=Fi(16,i.byteLength);return L().fill(0,a,i.byteLength),Zr[e].push(()=>{new Uint8Array(i).set(L().subarray(a>>>0,a+i.byteLength>>>0)),mi(a)}),a}function mn(e,t,r,n,i){e>>>=0,t=be(t),r=be(r),i>>>=0;var a=Kr(e);Zr[e]=[],4294967295==i&&(i=void 0),ne+=1,Qr(t,a.mapAsync(r,n>>>0,i).then(()=>{--ne,Ui(t,1,0)},r=>{--ne,qi();var n=Hr(r.message);Ui(t,"AbortError"===r.name?4:"OperationError"===r.name?3:0,n),delete Zr[e]}))}function wn(e){var t=Kr(e>>>=0),r=Zr[e];if(r){for(var n=0;n<r.length;++n)r[n]();delete Zr[e],t.unmap()}}function gn(e){delete qr[e>>>0]}function bn(e,t,r){e>>>=0,t>>>=0,r>>>=0;var n=!!W()[t+32>>>2>>>0];t={label:tn(t+4),usage:W()[t+16>>>2>>>0],size:4294967296*W()[t+28>>>2>>>0]+W()[t+24>>>2>>>0],mappedAtCreation:n},e=Kr(e);try{var i=e.createBuffer(t)}catch{return!1}return Yr(r,i),n&&(Zr[r]=[]),!0}function vn(e,t,r){e>>>=0,t>>>=0,r>>>=0;var n=W()[t>>>2>>>0],i=W()[n+4>>>2>>>0];t={label:tn(t+4),code:""},2===i&&(t.code=en(n+8)),Yr(r,Kr(e).createShaderModule(t))}var Cn=e=>{Kr(e).destroy()};function _n(e,t){t=be(t),e=Kr(e>>>0),ne+=1,Qr(t,e.popErrorScope().then(e=>{--ne;var r=5;e?e instanceof GPUValidationError?r=2:e instanceof GPUOutOfMemoryError?r=3:e instanceof GPUInternalError&&(r=4):r=1;var n=qi();e=e?Hr(e.message):0,Mi(t,1,r,e),zi(n)},e=>{--ne;var r=qi();e=Hr(e.message),Mi(t,1,5,e),zi(r)}))}function Tn(e,t,r,n){if(t=be(t),n>>>=0,r>>>=0){var i=W()[r+4>>>2>>>0];i={featureLevel:on[i],powerPreference:ln[W()[r+8>>>2>>>0]],forceFallbackAdapter:!!W()[r+12>>>2>>>0]},0!==(r=W()[r>>>2>>>0])&&(W(),i.rd=!!W()[r+8>>>2>>>0])}"gpu"in navigator?(ne+=1,Qr(t,navigator.gpu.requestAdapter(i).then(e=>{if(--ne,e)Yr(n,e),Ri(t,1,n,0);else{e=qi();var r=Hr("WebGPU not available on this browser (requestAdapter returned null)");Ri(t,3,n,r),zi(e)}},e=>{--ne;var r=qi();e=Hr(e.message),Ri(t,4,n,e),zi(r)}))):(r=qi(),i=Hr("WebGPU not available on this browser (navigator.gpu is not available)"),Ri(t,3,n,i),zi(r))}function En(e,t,r){return e>>>=0,t>>>=0,r>>>=0,zt(async()=>{var n=[];if(r){var i=N()[r>>>2>>>0];n.length=t+1,n[t]=new Promise(e=>setTimeout(e,i,0))}else n.length=t;for(var a=0;a<t;++a){var o=4294967296*W()[e+8*a+4>>>2>>>0]+W()[e+8*a>>>2>>>0];if(!(o in Xr))return o;n[a]=Xr[o]}return n=await Promise.race(n),delete Xr[n],n})}var xn,An={},On=()=>{if(!xn){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in An)void 0===An[e]?delete t[e]:t[e]=An[e];var r=[];for(e in t)r.push(`${e}=${t[e]}`);xn=r}return xn};function In(e,t){if(l)return ie(19,1,e,t);e>>>=0,t>>>=0;var r,n=0,i=0;for(r of On()){var a=t+n;W()[e+i>>>2>>>0]=a,n+=ut(r,a,1/0)+1,i+=4}return 0}function Sn(e,t){if(l)return ie(20,1,e,t);e>>>=0,t>>>=0;var r=On();for(var n of(W()[e>>>2>>>0]=r.length,e=0,r))e+=ft(n)+1;return W()[t>>>2>>>0]=e,0}function Bn(e){return l?ie(21,1,e):52}function Un(e,t,r,n){return l?ie(22,1,e,t,r,n):52}function Mn(e,t,r,n){return l?ie(23,1,e,t,r,n):70}var Rn=[null,[],[]];function $n(e,t,r,n){if(l)return ie(24,1,e,t,r,n);t>>>=0,r>>>=0,n>>>=0;for(var i=0,a=0;a<r;a++){var o=W()[t>>>2>>>0],s=W()[t+4>>>2>>>0];t+=8;for(var u=0;u<s;u++){var f=e,d=L()[o+u>>>0],c=Rn[f];0===d||10===d?((1===f?M:R)(Ee(c)),c.length=0):c.push(d)}i+=s}return W()[n>>>2>>>0]=i,0}function Pn(e,t){return rn(Kr(e>>>0).limits,t>>>0),1}function jn(e,t){return Kr(e>>>0).features.has(sn[t])}function Ln(e){return BigInt(Kr(e>>>0).size)}function kn(e){return BigInt(Kr(e>>>0).usage)}function Dn(e,t){if(e>>>=0,t>>>=0){var r=tn(t+4);r={label:r,timestampWrites:t=0!==(t=W()[t+12>>>2>>>0])?{querySet:Kr(W()[t+4>>>2>>>0]),beginningOfPassWriteIndex:W()[t+8>>>2>>>0],endOfPassWriteIndex:W()[t+12>>>2>>>0]}:void 0}}return e=Kr(e),t=Ei(0),Yr(t,e.beginComputePass(r)),t}function Nn(e,t,r,n,i,a){r=be(r),i=be(i),a=be(a),Kr(e>>>0).copyBufferToBuffer(Kr(t>>>0),r,Kr(n>>>0),i,a)}function Wn(e){e=Kr(e>>>0);var t=_i(0);return Yr(t,e.finish()),t}function Gn(e,t,r,n,i,a){a=be(a),Kr(e>>>0).resolveQuerySet(Kr(t>>>0),r,n,Kr(i>>>0),a)}function Fn(e,t,r,n){Kr(e>>>0).dispatchWorkgroups(t,r,n)}function Vn(e){Kr(e>>>0).end()}function zn(e,t,r,n,i){n>>>=0,i>>>=0,e=Kr(e>>>0),r=Kr(r>>>0),0==n?e.setBindGroup(t,r):e.setBindGroup(t,r,W(),i>>>2,n)}function Hn(e,t){Kr(e>>>0).setPipeline(Kr(t>>>0))}function qn(e,t,r){Kr(e>>>0).qd(Kr(t>>>0),r)}function Yn(e,t){e=Kr(e>>>0);var r=Ci(0);return Yr(r,e.getBindGroupLayout(t)),r}function Zn(e,t){e>>>=0;var r=tn(4+(t>>>=0)),n=Kr(W()[t+12>>>2>>>0]),i=W()[t+16>>>2>>>0];t=W()[t+20>>>2>>>0];for(var a=[],o=0;o<i;++o){var s=a,l=s.push,u=t+40*o,f=W()[u+8>>>2>>>0],d=W()[u+32>>>2>>>0],c=W()[u+36>>>2>>>0],p=W()[u+4>>>2>>>0];f?(d=u+24,-1==(d=W()[d>>>2>>>0]+4294967296*N()[d+4>>>2>>>0])&&(d=void 0),u={binding:p,resource:{buffer:Kr(f),offset:4294967296*W()[u+4+16>>>2>>>0]+W()[u+16>>>2>>>0],size:d}}):u=d?{binding:p,resource:Kr(d)}:{binding:p,resource:Kr(c)},l.call(s,u)}return r={label:r,layout:n,entries:a},e=Kr(e),n=vi(0),Yr(n,e.createBindGroup(r)),n}function Xn(e,t){var r;return e>>>=0,(t>>>=0)&&(r={label:tn(t+4)}),e=Kr(e),t=Ti(0),Yr(t,e.createCommandEncoder(r)),t}function Qn(e,t){e>>>=0;var r=t>>>0;t=tn(r+4);var n=(n=W()[r+12>>>2>>>0])?Kr(n):"auto";if(r+=16){var i=Kr(W()[r+4>>>2>>>0]),a=W()[r+16>>>2>>>0],o=W()[r+20>>>2>>>0];if(a){for(var s={},l=0;l<a;++l){var u=o+24*l;s[en(u+4)]=F()[u+16>>>3>>>0]}a=s}else a=void 0;r={module:i,constants:a,entryPoint:tn(r+8)}}else r=void 0;return t={label:t,layout:n,compute:r},e=Kr(e),n=xi(0),Yr(n,e.createComputePipeline(t)),n}function Kn(e,t){e>>>=0,t>>>=0,t={type:un[W()[t+12>>>2>>>0]],count:W()[t+16>>>2>>>0]},e=Kr(e);var r=Ai(0);return Yr(r,e.createQuerySet(t)),r}function Jn(e,t){e=Kr(e>>>0).adapterInfo,t>>>=0,N()[t+52>>>2>>>0]=e.subgroupMinSize,N()[t+56>>>2>>>0]=e.subgroupMaxSize;var r=e.vendor+e.architecture+e.device+e.description,n=ft(r)+1,i=wi(n);return i&&ut(r,i,n),r=i,n=ft(e.vendor),Jr(t+4,r,n),r+=n,n=ft(e.architecture),Jr(t+12,r,n),r+=n,n=ft(e.device),Jr(t+20,r,n),Jr(t+28,r+n,ft(e.description)),N()[t+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,N()[t+40>>>2>>>0]=e,N()[t+44>>>2>>>0]=0,N()[t+48>>>2>>>0]=0,1}function ei(e,t){t>>>=0,e=Kr(e>>>0);var r=wi(4*e.features.size),n=0,i=0;e.features.forEach(e=>{void 0!==(e=fn[e])&&(N()[r+n>>>2>>>0]=e,n+=4,i++)}),W()[t+4>>>2>>>0]=r,W()[t>>>2>>>0]=i}function ti(e,t){return rn(Kr(e>>>0).limits,t>>>0),1}function ri(e,t){return Kr(e>>>0).features.has(sn[t])}function ni(e,t){Kr(e>>>0).pushErrorScope(an[t])}function ii(e,t,r){t>>>=0,r>>>=0,e=Kr(e>>>0),t=Array.from(N().subarray(r>>>2>>>0,r+4*t>>>2>>>0),e=>Kr(e)),e.submit(t)}function ai(e,t,r,n,i){r=be(r),n>>>=0,i>>>=0,e=Kr(e>>>0),t=Kr(t>>>0),n=L().subarray(n>>>0,n+i>>>0),e.writeBuffer(t,r,n,0,i)}l||function(){for(var e=i.numThreads-1;e--;)ye();te.push(()=>{var e;Y++,e=()=>X(),l?e():Promise.all(le.map(he)).then(e)})}();for(var oi=Array(256),si=0;256>si;++si)oi[si]=String.fromCharCode(si);De=oi,Ke.push(0,1,void 0,1,null,1,!0,1,!1,1),i.count_emval_handles=()=>Ke.length/2-5-Qe.length,l||(m=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),z()),i.wasmBinary&&(y=i.wasmBinary),i.stackSave=()=>qi(),i.stackRestore=e=>zi(e),i.stackAlloc=e=>Hi(e),i.setValue=function(e,t,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":j()[e>>>0]=t;break;case"i16":k()[e>>>1>>>0]=t;break;case"i32":N()[e>>>2>>>0]=t;break;case"i64":A[e>>>3]=BigInt(t);break;case"float":G()[e>>>2>>>0]=t;break;case"double":F()[e>>>3>>>0]=t;break;case"*":W()[e>>>2>>>0]=t;break;default:Q(`invalid type for setValue: ${r}`)}},i.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return j()[e>>>0];case"i16":return k()[e>>>1>>>0];case"i32":return N()[e>>>2>>>0];case"i64":return A[e>>>3];case"float":return G()[e>>>2>>>0];case"double":return F()[e>>>3>>>0];case"*":return W()[e>>>2>>>0];default:Q(`invalid type for getValue: ${t}`)}},i.UTF8ToString=xe,i.stringToUTF8=ut,i.lengthBytesUTF8=ft;var li=[ae,oe,Ce,Ae,Oe,Ie,Se,Be,Ue,Me,Re,$e,Pe,je,Le,ke,vr,Cr,Er,In,Sn,Bn,Un,Mn,$n],ui={1048636:(e,t,r,n,a)=>{if(void 0===i||!i.fc)return 1;if((e=xe(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=i.fc.get(e)))return 2;if(t=Number(t>>>0),r=Number(r>>>0),n=Number(n>>>0),t+r>e.byteLength)return 3;try{let o=e.subarray(t,t+r);switch(a){case 0:L().set(o,n>>>0);break;case 1:i.Pc?i.Pc(n,o):i.jd(n,o);break;default:return 4}return 0}catch{return 4}},1049460:(e,t,r)=>{i.Rc(e,L().subarray(t>>>0,t+r>>>0))},1049524:()=>i.ed(),1049566:e=>{i.Qc(e)},1049603:()=>typeof wasmOffsetConverter<"u"};function fi(){return typeof wasmOffsetConverter<"u"}var di=await async function(){function e(e,t){return di=e.exports,di=function(){var e=di,t={};for(let[r,n]of Object.entries(e))t[r]="function"==typeof n?(...e)=>{Dt.push(r);try{return n(...e)}finally{$||(Dt.pop(),Lt&&1===jt&&0===Dt.length&&(jt=0,ne+=1,Pt(Xi),typeof Fibers<"u"&&Fibers.od()))}}:n;return t}(),n=di,i=e=>t=>e(t)>>>0,a=e=>()=>e()>>>0,(n=Object.assign({},n)).ob=i(n.ob),n.Rb=a(n.Rb),n.Tb=i(n.Tb),n.Dc=(r=n.Dc,(e,t)=>r(e,t)>>>0),n.Gc=i(n.Gc),n.Hc=a(n.Hc),n.__cxa_get_exception_ptr=i(n.__cxa_get_exception_ptr),di=n,fe.push(di.vc),w=t,X(),di;var r,n,i,a}Y++;var t=K();if(i.instantiateWasm)return new Promise(r=>{i.instantiateWasm(t,(t,n)=>{r(e(t,n))})});if(l)return new Promise(t=>{S=r=>{var n=new WebAssembly.Instance(r,K());t(e(n,r))}});q??=i.locateFile?i.locateFile?i.locateFile("ort-wasm-simd-threaded.asyncify.wasm",h):h+"ort-wasm-simd-threaded.asyncify.wasm":new URL(r(/*! ort-wasm-simd-threaded.asyncify.wasm */"./node_modules/onnxruntime-web/dist/ort-wasm-simd-threaded.asyncify.wasm"),r.b).href;try{var a=await async function(e){var t=q;if(!y&&"function"==typeof WebAssembly.instantiateStreaming&&!P(t))try{var r=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(r,e)}catch(e){R(`wasm streaming compile failed: ${e}`),R("falling back to ArrayBuffer instantiation")}return async function(e,t){try{var r=await async function(e){if(!y)try{var t=await d(e);return new Uint8Array(t)}catch{}if(e==q&&y)e=new Uint8Array(y);else{if(!c)throw"both async and sync fetching of the wasm failed";e=c(e)}return e}(e);return await WebAssembly.instantiate(r,t)}catch(e){R(`failed to asynchronously prepare wasm: ${e}`),Q(e)}}(t,e)}(t);return e(a.instance,a.module)}catch(e){return n(e),Promise.reject(e)}}(),ci=e=>(ci=di.ob)(e),pi=()=>(pi=di.pb)();i._OrtInit=(e,t)=>(i._OrtInit=di.qb)(e,t),i._OrtGetLastError=(e,t)=>(i._OrtGetLastError=di.rb)(e,t),i._OrtCreateSessionOptions=(e,t,r,n,a,o,s,l,u,f)=>(i._OrtCreateSessionOptions=di.sb)(e,t,r,n,a,o,s,l,u,f),i._OrtAppendExecutionProvider=(e,t,r,n,a)=>(i._OrtAppendExecutionProvider=di.tb)(e,t,r,n,a),i._OrtAddFreeDimensionOverride=(e,t,r)=>(i._OrtAddFreeDimensionOverride=di.ub)(e,t,r),i._OrtAddSessionConfigEntry=(e,t,r)=>(i._OrtAddSessionConfigEntry=di.vb)(e,t,r),i._OrtReleaseSessionOptions=e=>(i._OrtReleaseSessionOptions=di.wb)(e),i._OrtCreateSession=(e,t,r)=>(i._OrtCreateSession=di.xb)(e,t,r),i._OrtReleaseSession=e=>(i._OrtReleaseSession=di.yb)(e),i._OrtGetInputOutputCount=(e,t,r)=>(i._OrtGetInputOutputCount=di.zb)(e,t,r),i._OrtGetInputOutputMetadata=(e,t,r,n)=>(i._OrtGetInputOutputMetadata=di.Ab)(e,t,r,n),i._OrtFree=e=>(i._OrtFree=di.Bb)(e),i._OrtCreateTensor=(e,t,r,n,a,o)=>(i._OrtCreateTensor=di.Cb)(e,t,r,n,a,o),i._OrtGetTensorData=(e,t,r,n,a)=>(i._OrtGetTensorData=di.Db)(e,t,r,n,a),i._OrtReleaseTensor=e=>(i._OrtReleaseTensor=di.Eb)(e),i._OrtCreateRunOptions=(e,t,r,n)=>(i._OrtCreateRunOptions=di.Fb)(e,t,r,n),i._OrtAddRunConfigEntry=(e,t,r)=>(i._OrtAddRunConfigEntry=di.Gb)(e,t,r),i._OrtReleaseRunOptions=e=>(i._OrtReleaseRunOptions=di.Hb)(e),i._OrtCreateBinding=e=>(i._OrtCreateBinding=di.Ib)(e),i._OrtBindInput=(e,t,r)=>(i._OrtBindInput=di.Jb)(e,t,r),i._OrtBindOutput=(e,t,r,n)=>(i._OrtBindOutput=di.Kb)(e,t,r,n),i._OrtClearBoundOutputs=e=>(i._OrtClearBoundOutputs=di.Lb)(e),i._OrtReleaseBinding=e=>(i._OrtReleaseBinding=di.Mb)(e),i._OrtRunWithBinding=(e,t,r,n,a)=>(i._OrtRunWithBinding=di.Nb)(e,t,r,n,a),i._OrtRun=(e,t,r,n,a,o,s,l)=>(i._OrtRun=di.Ob)(e,t,r,n,a,o,s,l),i._OrtEndProfiling=e=>(i._OrtEndProfiling=di.Pb)(e);var hi=i._OrtGetWebGpuDevice=e=>(hi=i._OrtGetWebGpuDevice=di.Qb)(e),yi=()=>(yi=di.Rb)(),mi=i._free=e=>(mi=i._free=di.Sb)(e),wi=i._malloc=e=>(wi=i._malloc=di.Tb)(e),gi=i._wgpuBufferRelease=e=>(gi=i._wgpuBufferRelease=di.Ub)(e),bi=i._wgpuCreateInstance=e=>(bi=i._wgpuCreateInstance=di.Vb)(e),vi=e=>(vi=di.Wb)(e),Ci=e=>(Ci=di.Xb)(e),_i=e=>(_i=di.Yb)(e),Ti=e=>(Ti=di.Zb)(e),Ei=e=>(Ei=di._b)(e),xi=e=>(xi=di.$b)(e),Ai=e=>(Ai=di.bc)(e),Oi=(e,t)=>(Oi=di.lc)(e,t),Ii=(e,t)=>(Ii=di.mc)(e,t),Si=e=>(Si=di.nc)(e),Bi=(e,t,r)=>(Bi=di.pc)(e,t,r),Ui=(e,t,r)=>(Ui=di.qc)(e,t,r),Mi=(e,t,r,n)=>(Mi=di.rc)(e,t,r,n),Ri=(e,t,r,n)=>(Ri=di.sc)(e,t,r,n),$i=(e,t,r,n)=>($i=di.tc)(e,t,r,n),Pi=(e,t,r)=>(Pi=di.uc)(e,t,r),ji=(e,t,r,n,i,a)=>(ji=di.wc)(e,t,r,n,i,a),Li=()=>(Li=di.xc)(),ki=(e,t,r,n,i)=>(ki=di.yc)(e,t,r,n,i),Di=e=>(Di=di.zc)(e),Ni=e=>(Ni=di.Ac)(e),Wi=(e,t)=>(Wi=di.Bc)(e,t),Gi=()=>(Gi=di.Cc)(),Fi=(e,t)=>(Fi=di.Dc)(e,t),Vi=(e,t)=>(Vi=di.Ec)(e,t),zi=e=>(zi=di.Fc)(e),Hi=e=>(Hi=di.Gc)(e),qi=()=>(qi=di.Hc)(),Yi=i.dynCall_ii=(e,t)=>(Yi=i.dynCall_ii=di.Ic)(e,t);i.dynCall_viiii=(e,t,r,n,a)=>(i.dynCall_viiii=di.dynCall_viiii)(e,t,r,n,a),i.dynCall_viiiii=(e,t,r,n,a,o)=>(i.dynCall_viiiii=di.dynCall_viiiii)(e,t,r,n,a,o),i.dynCall_viii=(e,t,r,n)=>(i.dynCall_viii=di.Jc)(e,t,r,n),i.dynCall_vi=(e,t)=>(i.dynCall_vi=di.dynCall_vi)(e,t),i.dynCall_viijj=(e,t,r,n,a)=>(i.dynCall_viijj=di.dynCall_viijj)(e,t,r,n,a),i.dynCall_viiiiii=(e,t,r,n,a,o,s)=>(i.dynCall_viiiiii=di.dynCall_viiiiii)(e,t,r,n,a,o,s),i.dynCall_viiiiiiii=(e,t,r,n,a,o,s,l,u)=>(i.dynCall_viiiiiiii=di.dynCall_viiiiiiii)(e,t,r,n,a,o,s,l,u),i.dynCall_i=e=>(i.dynCall_i=di.dynCall_i)(e),i.dynCall_vii=(e,t,r)=>(i.dynCall_vii=di.dynCall_vii)(e,t,r),i.dynCall_fffffff=(e,t,r,n,a,o,s)=>(i.dynCall_fffffff=di.dynCall_fffffff)(e,t,r,n,a,o,s),i.dynCall_iiiii=(e,t,r,n,a)=>(i.dynCall_iiiii=di.dynCall_iiiii)(e,t,r,n,a),i.dynCall_iii=(e,t,r)=>(i.dynCall_iii=di.dynCall_iii)(e,t,r),i.dynCall_iiiiii=(e,t,r,n,a,o)=>(i.dynCall_iiiiii=di.dynCall_iiiiii)(e,t,r,n,a,o),i.dynCall_iiiiiiii=(e,t,r,n,a,o,s,l)=>(i.dynCall_iiiiiiii=di.dynCall_iiiiiiii)(e,t,r,n,a,o,s,l),i.dynCall_iiiiiii=(e,t,r,n,a,o,s)=>(i.dynCall_iiiiiii=di.dynCall_iiiiiii)(e,t,r,n,a,o,s),i.dynCall_iiii=(e,t,r,n)=>(i.dynCall_iiii=di.dynCall_iiii)(e,t,r,n),i.dynCall_vfiii=(e,t,r,n,a)=>(i.dynCall_vfiii=di.dynCall_vfiii)(e,t,r,n,a),i.dynCall_viiiiff=(e,t,r,n,a,o,s)=>(i.dynCall_viiiiff=di.dynCall_viiiiff)(e,t,r,n,a,o,s),i.dynCall_viiiiiff=(e,t,r,n,a,o,s,l)=>(i.dynCall_viiiiiff=di.dynCall_viiiiiff)(e,t,r,n,a,o,s,l),i.dynCall_ffff=(e,t,r,n)=>(i.dynCall_ffff=di.dynCall_ffff)(e,t,r,n),i.dynCall_viiff=(e,t,r,n,a)=>(i.dynCall_viiff=di.dynCall_viiff)(e,t,r,n,a),i.dynCall_jjjjjjj=(e,t,r,n,a,o,s)=>(i.dynCall_jjjjjjj=di.dynCall_jjjjjjj)(e,t,r,n,a,o,s),i.dynCall_jjjjjj=(e,t,r,n,a,o)=>(i.dynCall_jjjjjj=di.dynCall_jjjjjj)(e,t,r,n,a,o),i.dynCall_iijjii=(e,t,r,n,a,o)=>(i.dynCall_iijjii=di.dynCall_iijjii)(e,t,r,n,a,o),i.dynCall_viiiiiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d,c,p,h)=>(i.dynCall_viiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d,c,p,h),i.dynCall_viiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d)=>(i.dynCall_viiiiiiiiii=di.dynCall_viiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d),i.dynCall_viiiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d,c)=>(i.dynCall_viiiiiiiiiii=di.dynCall_viiiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d,c),i.dynCall_viiiiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d,c,p)=>(i.dynCall_viiiiiiiiiiii=di.dynCall_viiiiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d,c,p),i.dynCall_viiiiiiiiiiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y,m,w,g,b)=>(i.dynCall_viiiiiiiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y,m,w,g,b),i.dynCall_viiiiiiiii=(e,t,r,n,a,o,s,l,u,f)=>(i.dynCall_viiiiiiiii=di.dynCall_viiiiiiiii)(e,t,r,n,a,o,s,l,u,f),i.dynCall_viiiiiiiiiiiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y,m,w,g,b,v)=>(i.dynCall_viiiiiiiiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y,m,w,g,b,v),i.dynCall_viiiiiii=(e,t,r,n,a,o,s,l)=>(i.dynCall_viiiiiii=di.dynCall_viiiiiii)(e,t,r,n,a,o,s,l),i.dynCall_viiiiiiiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y,m)=>(i.dynCall_viiiiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y,m),i.dynCall_jiji=(e,t,r,n)=>(i.dynCall_jiji=di.dynCall_jiji)(e,t,r,n),i.dynCall_v=e=>(i.dynCall_v=di.dynCall_v)(e),i.dynCall_iidiiii=(e,t,r,n,a,o,s)=>(i.dynCall_iidiiii=di.dynCall_iidiiii)(e,t,r,n,a,o,s),i.dynCall_ji=(e,t)=>(i.dynCall_ji=di.dynCall_ji)(e,t),i.dynCall_vij=(e,t,r)=>(i.dynCall_vij=di.dynCall_vij)(e,t,r),i.dynCall_viiijii=(e,t,r,n,a,o,s)=>(i.dynCall_viiijii=di.dynCall_viiijii)(e,t,r,n,a,o,s),i.dynCall_viijiiiiiiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y,m,w,g)=>(i.dynCall_viijiiiiiiiiiiiiii=di.dynCall_viijiiiiiiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y,m,w,g),i.dynCall_viiiji=(e,t,r,n,a,o)=>(i.dynCall_viiiji=di.dynCall_viiiji)(e,t,r,n,a,o),i.dynCall_jfi=(e,t,r)=>(i.dynCall_jfi=di.dynCall_jfi)(e,t,r),i.dynCall_fif=(e,t,r)=>(i.dynCall_fif=di.dynCall_fif)(e,t,r),i.dynCall_jii=(e,t,r)=>(i.dynCall_jii=di.dynCall_jii)(e,t,r),i.dynCall_viiiijii=(e,t,r,n,a,o,s,l)=>(i.dynCall_viiiijii=di.dynCall_viiiijii)(e,t,r,n,a,o,s,l),i.dynCall_iij=(e,t,r)=>(i.dynCall_iij=di.dynCall_iij)(e,t,r),i.dynCall_viji=(e,t,r,n)=>(i.dynCall_viji=di.dynCall_viji)(e,t,r,n),i.dynCall_iiiiiiiii=(e,t,r,n,a,o,s,l,u)=>(i.dynCall_iiiiiiiii=di.dynCall_iiiiiiiii)(e,t,r,n,a,o,s,l,u),i.dynCall_iiij=(e,t,r,n)=>(i.dynCall_iiij=di.dynCall_iiij)(e,t,r,n),i.dynCall_iiiiiiiiii=(e,t,r,n,a,o,s,l,u,f)=>(i.dynCall_iiiiiiiiii=di.dynCall_iiiiiiiiii)(e,t,r,n,a,o,s,l,u,f),i.dynCall_iiiiiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d,c,p)=>(i.dynCall_iiiiiiiiiiiii=di.dynCall_iiiiiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d,c,p),i.dynCall_iiiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d)=>(i.dynCall_iiiiiiiiiii=di.dynCall_iiiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d),i.dynCall_iijii=(e,t,r,n,a)=>(i.dynCall_iijii=di.dynCall_iijii)(e,t,r,n,a),i.dynCall_fiii=(e,t,r,n)=>(i.dynCall_fiii=di.dynCall_fiii)(e,t,r,n),i.dynCall_viijii=(e,t,r,n,a,o)=>(i.dynCall_viijii=di.dynCall_viijii)(e,t,r,n,a,o),i.dynCall_viij=(e,t,r,n)=>(i.dynCall_viij=di.dynCall_viij)(e,t,r,n),i.dynCall_jiij=(e,t,r,n)=>(i.dynCall_jiij=di.dynCall_jiij)(e,t,r,n),i.dynCall_fi=(e,t)=>(i.dynCall_fi=di.dynCall_fi)(e,t),i.dynCall_fii=(e,t,r)=>(i.dynCall_fii=di.dynCall_fii)(e,t,r),i.dynCall_dii=(e,t,r)=>(i.dynCall_dii=di.dynCall_dii)(e,t,r),i.dynCall_fiiii=(e,t,r,n,a)=>(i.dynCall_fiiii=di.dynCall_fiiii)(e,t,r,n,a),i.dynCall_viiiiiiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y)=>(i.dynCall_viiiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y),i.dynCall_viiiiiiiiiiiiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y,m,w,g,b,v,C)=>(i.dynCall_viiiiiiiiiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y,m,w,g,b,v,C),i.dynCall_viiiiiiiiiiiiiiii=(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y,m,w)=>(i.dynCall_viiiiiiiiiiiiiiii=di.dynCall_viiiiiiiiiiiiiiii)(e,t,r,n,a,o,s,l,u,f,d,c,p,h,y,m,w),i.dynCall_iif=(e,t,r)=>(i.dynCall_iif=di.dynCall_iif)(e,t,r),i.dynCall_jiiii=(e,t,r,n,a)=>(i.dynCall_jiiii=di.dynCall_jiiii)(e,t,r,n,a),i.dynCall_jiii=(e,t,r,n)=>(i.dynCall_jiii=di.dynCall_jiii)(e,t,r,n),i.dynCall_viif=(e,t,r,n)=>(i.dynCall_viif=di.dynCall_viif)(e,t,r,n),i.dynCall_viiij=(e,t,r,n,a)=>(i.dynCall_viiij=di.dynCall_viiij)(e,t,r,n,a),i.dynCall_iiiiij=(e,t,r,n,a,o)=>(i.dynCall_iiiiij=di.dynCall_iiiiij)(e,t,r,n,a,o),i.dynCall_iiiiid=(e,t,r,n,a,o)=>(i.dynCall_iiiiid=di.dynCall_iiiiid)(e,t,r,n,a,o),i.dynCall_iiiiijj=(e,t,r,n,a,o,s)=>(i.dynCall_iiiiijj=di.dynCall_iiiiijj)(e,t,r,n,a,o,s),i.dynCall_iiiiiijj=(e,t,r,n,a,o,s,l)=>(i.dynCall_iiiiiijj=di.dynCall_iiiiiijj)(e,t,r,n,a,o,s,l);var Zi=e=>(Zi=di.Kc)(e),Xi=()=>(Xi=di.Lc)(),Qi=e=>(Qi=di.Mc)(e),Ki=()=>(Ki=di.Nc)();return function e(){if(0<Y)Z=e;else if(l)t(i),H();else{for(;0<te.length;)te.shift()(i);0<Y?Z=e:(i.calledRun=!0,$||(H(),t(i)))}}(),i.PTR_SIZE=4,i.webgpuInit=e=>{let t,r,n=new WeakMap,a=1;i.webgpuRegisterDevice=e=>{if(void 0!==r)throw Error("another WebGPU EP inference session is being created.");if(e){var i=n.get(e);if(!i){let t=((e,t=0)=>{var r=Si(t);return t=Ii(t,r),Yr(r,e.queue),Yr(t,e),t})(e,i=bi(0));i=[a++,i,t],n.set(e,i)}return t=e,r=i[0],i}t=void 0,r=0};let o=new Map;i.webgpuOnCreateSession=n=>{if(void 0!==r){var i=r;if(r=void 0,n){let r=hi(i);o.set(n,r),0===i&&e(t??Kr(r))}t=void 0}},i.webgpuOnReleaseSession=e=>{o.delete(e)};let s=Symbol("gpuBufferMetadata");i.webgpuRegisterBuffer=(e,t,r)=>{if(r)return e[s]=[r,NaN],r;if(r=e[s])return r[1]++,r[0];if(void 0===(t=o.get(t)))throw Error("Invalid session handle passed to webgpuRegisterBuffer");return t=((e,t=0)=>("pending"!=e.mapState||Q(),t=Oi(t,"mapped"==e.mapState?3:1),Yr(t,e),"mapped"==e.mapState&&(Zr[t]=[]),t))(e,t),e[s]=[t,1],t},i.webgpuUnregisterBuffer=e=>{let t=e[s];if(!t)throw Error("Buffer is not registered");t[1]--,0===t[1]&&(gi(t[0]),delete e[s])},i.webgpuGetBuffer=e=>Kr(e),i.webgpuCreateDownloader=(e,t,r)=>{if(void 0===(r=o.get(r)))throw Error("Invalid session handle passed to webgpuRegisterBuffer");let n=Kr(r),i=16*Math.ceil(Number(t)/16);return async()=>{let r=n.createBuffer({size:i,usage:9});try{let a=n.createCommandEncoder();return a.copyBufferToBuffer(e,0,r,0,i),n.queue.submit([a.finish()]),await r.mapAsync(GPUMapMode.READ),r.getMappedRange().slice(0,t)}finally{r.destroy()}}},i.Pc=(e,n)=>{var i=n.buffer;let a=n.byteOffset,o=n.byteLength;if(n=16*Math.ceil(Number(o)/16),e=Kr(e),!t){var s=hi(r);t=Kr(s)}let l=(s=t.createBuffer({mappedAtCreation:!0,size:n,usage:6})).getMappedRange();new Uint8Array(l).set(new Uint8Array(i,a,o)),s.unmap(),(i=t.createCommandEncoder()).copyBufferToBuffer(s,0,e,0,n),t.queue.submit([i.finish()]),s.destroy()}},i.webnnInit=e=>{let t=e[0];[i.ed,i.Qc,i.webnnEnsureTensor,i.Rc,i.webnnDownloadTensor,i.dd,i.webnnEnableTraceEvent]=e.slice(1),i.webnnReleaseTensorId=i.Qc,i.webnnUploadTensor=i.Rc,i.webnnRegisterMLContext=i.dd,i.webnnOnRunStart=e=>t.onRunStart(e),i.webnnOnRunEnd=t.onRunEnd.bind(t),i.webnnOnReleaseSession=e=>{t.onReleaseSession(e)},i.webnnCreateMLTensorDownloader=(e,r)=>t.createMLTensorDownloader(e,r),i.webnnRegisterMLTensor=(e,r,n,i)=>t.registerMLTensor(e,r,n,i),i.webnnCreateMLContext=e=>t.createMLContext(e),i.webnnRegisterMLConstant=(e,r,n,a,o,s)=>t.registerMLConstant(e,r,n,a,o,i.fc,s),i.webnnRegisterGraphInput=t.registerGraphInput.bind(t),i.webnnIsGraphInput=t.isGraphInput.bind(t),i.webnnRegisterGraphOutput=t.registerGraphOutput.bind(t),i.webnnIsGraphOutput=t.isGraphOutput.bind(t),i.webnnCreateTemporaryTensor=t.createTemporaryTensor.bind(t),i.webnnIsGraphInputOutputTypeSupported=t.isGraphInputOutputTypeSupported.bind(t)},a},be=ge,ve=globalThis.self?.name?.startsWith("em-pthread"),ve&&ge()}),Bt=G(()=>{de(),Ce=typeof location>"u"?void 0:location.origin,_e=!0,Te=()=>{if(_e){let e=URL;return new URL(new e(r(/*! ort.webgpu.bundle.min.mjs */"./node_modules/onnxruntime-web/dist/ort.webgpu.bundle.min.mjs?3e05"),r.b).href,Ce).href}return"file:///D:/5650HightPerfprmance/WebGPU-Video-Diffusion/node_modules/onnxruntime-web/dist/ort.webgpu.bundle.min.mjs"},Ee=Te(),xe=()=>{if(Ee&&!Ee.startsWith("blob:"))return Ee.substring(0,Ee.lastIndexOf("/")+1)},Ae=(e,t)=>{try{let r=t??Ee;return(r?new URL(e,r):new URL(e)).origin===Ce}catch{return!1}},Oe=(e,t)=>{let r=t??Ee;try{return(r?new URL(e,r):new URL(e)).href}catch{return}},Ie=(e,t)=>`${t??"./"}${e}`,Se=async e=>{let t=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)},Be=async e=>(await import(e)).default,Ue=(me(),V(ce)).default,Me=async()=>{if(!Ee)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Ae(Ee))return[void 0,Ue()];let e=await Se(Ee);return[e,Ue(e)]},Re=(St(),V(we)).default,$e=async(e,t,r,n)=>{let i=Re&&!(e||t);if(i)if(Ee)i=Ae(Ee);else{if(!n||r)throw new Error("cannot determine the script source URL.");i=!0}if(i)return[void 0,Re];{let n="ort-wasm-simd-threaded.asyncify.mjs",i=e??Oe(n,t),a=r&&i&&!Ae(i,t),o=a?await Se(i):i??Ie(n,t);return[a?o:void 0,await Be(o)]}}}),Ut=G(()=>{Bt(),je=!1,Le=!1,ke=!1,De=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Ne=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},We=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Ge=async e=>{if(je)return Promise.resolve();if(Le)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(ke)throw new Error("previous call to 'initializeWebAssembly()' failed.");Le=!0;let t=e.initTimeout,r=e.numThreads;if(!1!==e.simd)if("relaxed"===e.simd){if(!We())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!Ne())throw new Error("WebAssembly SIMD is not supported in the current environment.");let n=De();r>1&&!n&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+r+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=r=1);let i=e.wasmPaths,a="string"==typeof i?i:void 0,o=i?.mjs,s=o?.href??o,l=i?.wasm,u=l?.href??l,f=e.wasmBinary,[d,c]=await $e(s,a,r>1,!!f||!!u),p=!1,h=[];if(t>0&&h.push(new Promise(e=>{setTimeout(()=>{p=!0,e()},t)})),h.push(new Promise((e,t)=>{let n={numThreads:r};if(f)n.wasmBinary=f;else if(u||a)n.locateFile=e=>u??a+e;else if(s&&0!==s.indexOf("blob:"))n.locateFile=e=>new URL(e,s).href;else if(d){let e=xe();e&&(n.locateFile=t=>e+t)}c(n).then(t=>{Le=!1,je=!0,Pe=t,e(),d&&URL.revokeObjectURL(d)},e=>{Le=!1,ke=!0,t(e)})})),await Promise.race(h),p)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},Fe=()=>{if(je&&Pe)return Pe;throw new Error("WebAssembly is not initialized yet.")}}),Mt=G(()=>{Ut(),Ve=(e,t)=>{let r=Fe(),n=r.lengthBytesUTF8(e)+1,i=r._malloc(n);return r.stringToUTF8(e,i,n),t.push(i),i},ze=(e,t,r,n)=>{if("object"==typeof e&&null!==e){if(r.has(e))throw new Error("Circular reference in options");r.add(e)}Object.entries(e).forEach(([e,i])=>{let a=t?t+e:e;if("object"==typeof i)ze(i,a+".",r,n);else if("string"==typeof i||"number"==typeof i)n(a,i.toString());else{if("boolean"!=typeof i)throw new Error("Can't handle extra config type: "+typeof i);n(a,i?"1":"0")}})},He=e=>{let t=Fe(),r=t.stackSave();try{let r=t.PTR_SIZE,n=t.stackAlloc(2*r);t._OrtGetLastError(n,n+r);let i=Number(t.getValue(n,4===r?"i32":"i64")),a=t.getValue(n+r,"*"),o=a?t.UTF8ToString(a):"";throw new Error(`${e} ERROR_CODE: ${i}, ERROR_MESSAGE: ${o}`)}finally{t.stackRestore(r)}}}),Rt=G(()=>{Ut(),Mt(),qe=e=>{let t=Fe(),r=0,n=[],i=e||{};try{if(void 0===e?.logSeverityLevel)i.logSeverityLevel=2;else if("number"!=typeof e.logSeverityLevel||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${e.logSeverityLevel}`);if(void 0===e?.logVerbosityLevel)i.logVerbosityLevel=0;else if("number"!=typeof e.logVerbosityLevel||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);void 0===e?.terminate&&(i.terminate=!1);let a=0;return void 0!==e?.tag&&(a=Ve(e.tag,n)),r=t._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,a),0===r&&He("Can't create run options."),void 0!==e?.extra&&ze(e.extra,"",new WeakSet,(e,i)=>{let a=Ve(e,n),o=Ve(i,n);0!==t._OrtAddRunConfigEntry(r,a,o)&&He(`Can't set a run config entry: ${e} - ${i}.`)}),[r,n]}catch(e){throw 0!==r&&t._OrtReleaseRunOptions(r),n.forEach(e=>t._free(e)),e}}}),$t=G(()=>{Ut(),Mt(),Ye=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},Ze=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},Xe=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(e=>"webgpu"===("string"==typeof e?e:e.name))&&(e.enableMemPattern=!1)},Qe=(e,t,r,n)=>{let i=Ve(t,n),a=Ve(r,n);0!==Fe()._OrtAddSessionConfigEntry(e,i,a)&&He(`Can't set a session config entry: ${t} - ${r}.`)},Ke=(e,t,r,n)=>{let i=Ve(t,n),a=Ve(r,n);e.push([i,a])},Je=async(e,t,r)=>{for(let n of t){let t="string"==typeof n?n:n.name,i=[];switch(t){case"webnn":if(t="WEBNN","string"!=typeof n){let t=n?.deviceType;t&&Qe(e,"deviceType",t,r)}break;case"webgpu":{let e;if(t="WebGPU","string"!=typeof n){let t=n;if(t.device){if(!(typeof GPUDevice<"u"&&t.device instanceof GPUDevice))throw new Error("Invalid GPU device set in WebGPU EP options.");e=t.device}}let a=Fe().webgpuRegisterDevice(e);if(a){let[e,t,n]=a;Ke(i,"deviceId",e.toString(),r),Ke(i,"webgpuInstance",t.toString(),r),Ke(i,"webgpuDevice",n.toString(),r)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${t}`)}let a=Ve(t,r),o=i.length,s=0,l=0;if(o>0){s=Fe()._malloc(o*Fe().PTR_SIZE),r.push(s),l=Fe()._malloc(o*Fe().PTR_SIZE),r.push(l);for(let e=0;e<o;e++)Fe().setValue(s+e*Fe().PTR_SIZE,i[e][0],"*"),Fe().setValue(l+e*Fe().PTR_SIZE,i[e][1],"*")}0!==await Fe()._OrtAppendExecutionProvider(e,a,s,l,o)&&He(`Can't append execution provider: ${t}.`)}},et=async e=>{let t=Fe(),r=0,n=[],i=e||{};Xe(i);try{let e=Ye(i.graphOptimizationLevel??"all"),a=Ze(i.executionMode??"sequential"),o="string"==typeof i.logId?Ve(i.logId,n):0,s=i.logSeverityLevel??2;if(!Number.isInteger(s)||s<0||s>4)throw new Error(`log severity level is not valid: ${s}`);let l=i.logVerbosityLevel??0;if(!Number.isInteger(l)||l<0||l>4)throw new Error(`log verbosity level is not valid: ${l}`);let u="string"==typeof i.optimizedModelFilePath?Ve(i.optimizedModelFilePath,n):0;if(r=t._OrtCreateSessionOptions(e,!!i.enableCpuMemArena,!!i.enableMemPattern,a,!!i.enableProfiling,0,o,s,l,u),0===r&&He("Can't create session options."),i.executionProviders&&await Je(r,i.executionProviders,n),void 0!==i.enableGraphCapture){if("boolean"!=typeof i.enableGraphCapture)throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);Qe(r,"enableGraphCapture",i.enableGraphCapture.toString(),n)}if(i.freeDimensionOverrides)for(let[e,a]of Object.entries(i.freeDimensionOverrides)){if("string"!=typeof e)throw new Error(`free dimension override name must be a string: ${e}`);if("number"!=typeof a||!Number.isInteger(a)||a<0)throw new Error(`free dimension override value must be a non-negative integer: ${a}`);let i=Ve(e,n);0!==t._OrtAddFreeDimensionOverride(r,i,a)&&He(`Can't set a free dimension override: ${e} - ${a}.`)}return void 0!==i.extra&&ze(i.extra,"",new WeakSet,(e,t)=>{Qe(r,e,t,n)}),[r,n]}catch(e){throw 0!==r&&0!==t._OrtReleaseSessionOptions(r)&&He("Can't release session options."),n.forEach(e=>t._free(e)),e}}}),Pt=G(()=>{tt=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},rt=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},nt=(e,t)=>{let r=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],n="number"==typeof t?t:t.reduce((e,t)=>e*t,1);return r>0?Math.ceil(n*r):void 0},it=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},at=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},ot=e=>"float32"===e||"float16"===e||"int32"===e||"int64"===e||"uint32"===e||"uint8"===e||"bool"===e||"uint4"===e||"int4"===e,st=e=>"float32"===e||"float16"===e||"int32"===e||"int64"===e||"uint32"===e||"uint64"===e||"int8"===e||"uint8"===e||"bool"===e||"uint4"===e||"int4"===e,lt=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),jt=G(()=>{de(),ut=async e=>{if("string"==typeof e){{let t=await fetch(e);if(!t.ok)throw new Error(`failed to load external data file: ${e}`);let r=t.headers.get("Content-Length"),n=r?parseInt(r,10):0;if(n<1073741824)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let r,i=t.body.getReader();try{r=new ArrayBuffer(n)}catch(e){if(!(e instanceof RangeError))throw e;{let e=Math.ceil(n/65536);r=new WebAssembly.Memory({initial:e,maximum:e}).buffer}}let a=0;for(;;){let{done:e,value:t}=await i.read();if(e)break;let n=t.byteLength;new Uint8Array(r,a,n).set(t),a+=n}return new Uint8Array(r,0,n)}}}return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),Lt=G(()=>{Pt(),ft=(e,t)=>new(it(t))(e)}),kt=G(()=>{Pt(),dt=["V","I","W","E","F"],ct=(e,t)=>{console.log(`[${dt[e]},${(new Date).toISOString()}]${t}`)},yt=(e,t)=>{pt=e,ht=t},mt=(e,t)=>{let r=at(e);r>=at(pt)&&ct(r,"function"==typeof t?t():t)},wt=(...e)=>{ht&&mt(...e)}}),Dt=G(()=>{Pt(),kt(),gt=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),bt=(e,t)=>{if("int32"===t)return e;let r=gt.get(t);if(!r)throw new Error(`WebNN backend does not support data type: ${t}`);let n=r/8;if(e.byteLength%n!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${n}.`);let i=e.byteLength/n,a=new(it(t))(e.buffer,e.byteOffset,i);switch(t){case"int64":case"uint64":{let e=new Int32Array(i);for(let t=0;t<i;t++){let r=a[t];if(r>2147483647n||r<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");e[t]=Number(r)}return new Uint8Array(e.buffer)}case"int8":case"uint8":case"uint32":{if("uint32"===t&&a.some(e=>e>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let e=Int32Array.from(a,Number);return new Uint8Array(e.buffer)}default:throw new Error(`Unsupported data conversion from ${t} to 'int32'`)}},vt=(e,t)=>{if("int32"===t)return e;if(e.byteLength%4!=0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let r=e.byteLength/4,n=new Int32Array(e.buffer,e.byteOffset,r);switch(t){case"int64":{let e=BigInt64Array.from(n,BigInt);return new Uint8Array(e.buffer)}case"uint64":{if(n.some(e=>e<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let e=BigUint64Array.from(n,BigInt);return new Uint8Array(e.buffer)}case"int8":{if(n.some(e=>e<-128||e>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let e=Int8Array.from(n,Number);return new Uint8Array(e.buffer)}case"uint8":if(n.some(e=>e<0||e>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(n,Number);case"uint32":{if(n.some(e=>e<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let e=Uint32Array.from(n,Number);return new Uint8Array(e.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${t}`)}},Ct=1,_t=()=>Ct++,Tt=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Et=(e,t)=>{let r=gt.get(e);if(!r)throw new Error(`WebNN backend does not support data type: ${e}`);return t.length>0?Math.ceil(t.reduce((e,t)=>e*t)*r/8):0},xt=class{constructor(e){this.isDataConverted=!1;let{sessionId:t,context:r,tensor:n,dataType:i,shape:a,fallbackDataType:o}=e;this.sessionId=t,this.mlContext=r,this.mlTensor=n,this.dataType=i,this.tensorShape=a,this.fallbackDataType=o}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Et(this.dataType,this.tensorShape)}destroy(){wt("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}async read(e){if(this.fallbackDataType){let t=await this.mlContext.readTensor(this.mlTensor),r=vt(new Uint8Array(t),this.dataType);return e?void(e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).set(r):r.buffer}return e?this.mlContext.readTensor(this.mlTensor,e):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(e,t,r){return this.mlContext===e&&this.dataType===t&&this.tensorShape.length===r.length&&this.tensorShape.every((e,t)=>e===r[t])}setIsDataConverted(e){this.isDataConverted=e}},At=class{constructor(e,t){this.tensorManager=e,this.wrapper=t}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(e,t,r,n){let i,a=this.tensorManager.getMLContext(e);if(!a.opSupportLimits().input.dataTypes.includes(t)){if(i=Tt.get(t),!i||!a.opSupportLimits().input.dataTypes.includes(i))throw new Error(`WebNN backend does not support data type: ${t}`);wt("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${t} to ${i}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(a,t,r))return this.wrapper.tensor;if(n){if(this.wrapper.byteLength!==Et(t,r))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let o=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(e,t,r,o,!0,!0,i),n&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(e){let t=e;if(this.wrapper){if(this.wrapper.fallbackType){if("int32"!==this.wrapper.fallbackType)throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);t=bt(e,this.wrapper.type),this.wrapper.setIsDataConverted(!0)}if(e.byteLength===this.wrapper.byteLength)return void this.wrapper.write(t);wt("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(t):this.activeUpload=new Uint8Array(t)}async download(e){if(this.activeUpload){let t=this.wrapper?.isDataConverted?vt(this.activeUpload,this.wrapper?.type):this.activeUpload;return e?void(e instanceof ArrayBuffer?new Uint8Array(e).set(t):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(t)):t.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read(e):this.wrapper.read()}},Ot=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let t=this.backend.getMLContext(e);if(!t)throw new Error("MLContext not found for session.");return t}reserveTensorId(){let e=_t();return this.tensorTrackersById.set(e,new At(this)),e}releaseTensorId(e){let t=this.tensorTrackersById.get(e);t&&(this.tensorTrackersById.delete(e),t.tensorWrapper&&this.releaseTensor(t.tensorWrapper))}async ensureTensor(e,t,r,n,i){wt("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${t}, dataType: ${r}, shape: ${n}, copyOld: ${i}}`);let a=this.tensorTrackersById.get(t);if(!a)throw new Error("Tensor not found.");return a.ensureTensor(e,r,n,i)}upload(e,t){let r=this.tensorTrackersById.get(e);if(!r)throw new Error("Tensor not found.");r.upload(t)}async download(e,t){wt("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${e}, dstBuffer: ${t?.byteLength}}`);let r=this.tensorTrackersById.get(e);if(!r)throw new Error("Tensor not found.");return r.download(t)}releaseTensorsForSession(e){for(let t of this.freeTensors)t.sessionId===e&&t.destroy();this.freeTensors=this.freeTensors.filter(t=>t.sessionId!==e)}registerTensor(e,t,r,n){let i=this.getMLContext(e),a=_t(),o=new xt({sessionId:e,context:i,tensor:t,dataType:r,shape:n});return this.tensorTrackersById.set(a,new At(this,o)),this.externalTensors.add(o),a}async getCachedTensor(e,t,r,n,i,a,o){let s=this.getMLContext(e);for(let[n,i]of this.freeTensors.entries())if(i.canReuseTensor(s,t,r)){wt("verbose",()=>`[WebNN] Reusing tensor {dataType: ${t}, ${o?`fallbackDataType: ${o},`:""} shape: ${r}`);let i=this.freeTensors.splice(n,1)[0];return i.sessionId=e,i}wt("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${t}, ${o?`fallbackDataType: ${o},`:""} shape: ${r}}`);let l=await s.createTensor({dataType:o??t,shape:r,dimensions:r,usage:n,writable:i,readable:a});return new xt({sessionId:e,context:s,tensor:l,dataType:t,shape:r,fallbackDataType:o})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},It=(...e)=>new Ot(...e)}),Nt={};F(Nt,{WebNNBackend:()=>Ft});var Wt,Gt,Ft,Vt,zt,Ht,qt,Yt,Zt,Xt,Qt,Kt,Jt,er,tr,rr,nr,ir,ar,or,sr,lr,ur,fr,dr,cr,pr,hr,yr,mr,wr,gr,br,vr,Cr,_r,Tr,Er=G(()=>{Pt(),Ut(),Lt(),Dt(),kt(),Wt=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Gt=(e,t)=>{if(e===t)return!0;if(void 0===e||void 0===t)return!1;let r=Object.keys(e).sort(),n=Object.keys(t).sort();return r.length===n.length&&r.every((r,i)=>r===n[i]&&e[r]===t[r])},Ft=class{constructor(e){this.tensorManager=It(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,yt(e.logLevel,!!e.debug)}get currentSessionId(){if(void 0===this.activeSessionId)throw new Error("No active session");return this.activeSessionId}onRunStart(e){wt("verbose",()=>`[WebNN] onRunStart {sessionId: ${e}}`),this.activeSessionId=e}onRunEnd(e){wt("verbose",()=>`[WebNN] onRunEnd {sessionId: ${e}}`);let t=this.temporarySessionTensorIds.get(e);if(t){for(let e of t)wt("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}async createMLContext(e){if(e instanceof GPUDevice){let t=this.mlContextCache.findIndex(t=>t.gpuDevice===e);if(-1!==t)return this.mlContextCache[t].mlContext;{let t=await navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:t}),t}}if(void 0===e){let e=this.mlContextCache.findIndex(e=>void 0===e.options&&void 0===e.gpuDevice);if(-1!==e)return this.mlContextCache[e].mlContext;{let e=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:e}),e}}let t=this.mlContextCache.findIndex(t=>Gt(t.options,e));if(-1!==t)return this.mlContextCache[t].mlContext;{let t=await navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:t}),t}}registerMLContext(e,t){this.mlContextBySessionId.set(e,t);let r=this.sessionIdsByMLContext.get(t);r||(r=new Set,this.sessionIdsByMLContext.set(t,r)),r.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(e,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e),this.sessionGraphOutputs.delete(e);let t=this.mlContextBySessionId.get(e);if(!t)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let r=this.sessionIdsByMLContext.get(t);if(r.delete(e),0===r.size){this.sessionIdsByMLContext.delete(t);let e=this.mlContextCache.findIndex(e=>e.mlContext===t);-1!==e&&this.mlContextCache.splice(e,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){wt("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e)}async ensureTensor(e,t,r,n,i){let a=Wt.get(r);if(!a)throw new Error(`Unsupported ONNX data type: ${r}`);return this.tensorManager.ensureTensor(e??this.currentSessionId,t,a,n,i)}async createTemporaryTensor(e,t,r){wt("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${t}, shape: ${r}}`);let n=Wt.get(t);if(!n)throw new Error(`Unsupported ONNX data type: ${t}`);let i=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(e,i,n,r,!1);let a=this.temporarySessionTensorIds.get(e);return a?a.push(i):this.temporarySessionTensorIds.set(e,[i]),i}uploadTensor(e,t){if(!Fe().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");wt("verbose",()=>`[WebNN] uploadTensor {tensorId: ${e}, data: ${t.byteLength}}`),this.tensorManager.upload(e,t)}async downloadTensor(e,t){return this.tensorManager.download(e,t)}createMLTensorDownloader(e,t){return async()=>{let r=await this.tensorManager.download(e);return ft(r,t)}}registerMLTensor(e,t,r,n){let i=Wt.get(r);if(!i)throw new Error(`Unsupported ONNX data type: ${r}`);let a=this.tensorManager.registerTensor(e,t,i,n);return wt("verbose",()=>`[WebNN] registerMLTensor {tensor: ${t}, dataType: ${i}, dimensions: ${n}} -> {tensorId: ${a}}`),a}registerMLConstant(e,t,r,n,i,a,o=!1){if(!a)throw new Error("External mounted files are not available.");let s=e;e.startsWith("./")&&(s=e.substring(2));let l=a.get(s);if(!l)throw new Error(`File with name ${s} not found in preloaded files.`);if(t+r>l.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let u,f=l.slice(t,t+r).buffer;switch(i.dataType){case"float32":u=new Float32Array(f);break;case"float16":u=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(f):new Uint16Array(f);break;case"int32":u=new Int32Array(f);break;case"uint32":u=new Uint32Array(f);break;case"int64":if(o){let e=bt(new Uint8Array(f),"int64");u=new Int32Array(e.buffer),i.dataType="int32"}else u=new BigInt64Array(f);break;case"uint64":u=new BigUint64Array(f);break;case"int8":u=new Int8Array(f);break;case"int4":case"uint4":case"uint8":u=new Uint8Array(f);break;default:throw new Error(`Unsupported data type: ${i.dataType} in creating WebNN Constant from external data.`)}return wt("verbose",()=>`[WebNN] registerMLConstant {dataType: ${i.dataType}, shape: ${i.shape}}} ${o?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),n.constant(i,u)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}registerGraphOutput(e){this.temporaryGraphOutputs.push(e)}isGraphInput(e,t){let r=this.sessionGraphInputs.get(e);return!!r&&r.includes(t)}isGraphOutput(e,t){let r=this.sessionGraphOutputs.get(e);return!!r&&r.includes(t)}isGraphInputOutputTypeSupported(e,t,r=!0){let n=this.mlContextBySessionId.get(e),i=Wt.get(tt(t));return!(typeof i>"u")&&(r?!!n?.opSupportLimits().input.dataTypes.includes(i):!!n?.opSupportLimits().output.dataTypes.includes(i))}flush(){}}}),xr=G(()=>{fe(),Rt(),$t(),Pt(),Ut(),Mt(),jt(),Vt=(e,t)=>{0!==Fe()._OrtInit(e,t)&&He("Can't initialize onnxruntime.")},zt=async e=>{Vt(e.wasm.numThreads,at(e.logLevel))},Ht=async(e,t)=>{Fe().asyncInit?.();let r=e.webgpu.adapter;if("webgpu"===t){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(r){if("object"!=typeof r.limits||"object"!=typeof r.features||"function"!=typeof r.requestDevice)throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let t=e.webgpu.powerPreference;if(void 0!==t&&"low-power"!==t&&"high-performance"!==t)throw new Error(`Invalid powerPreference setting: "${t}"`);let n=e.webgpu.forceFallbackAdapter;if(void 0!==n&&"boolean"!=typeof n)throw new Error(`Invalid forceFallbackAdapter setting: "${n}"`);if(r=await navigator.gpu.requestAdapter({powerPreference:t,forceFallbackAdapter:n}),!r)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if("webnn"===t&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if("webgpu"===t&&Fe().webgpuInit(t=>{e.webgpu.device=t}),"webnn"===t){let t=new((Er(),V(Nt)).WebNNBackend)(e);Fe().webnnInit([t,()=>t.reserveTensorId(),e=>t.releaseTensorId(e),async(e,r,n,i,a)=>t.ensureTensor(e,r,n,i,a),(e,r)=>{t.uploadTensor(e,r)},async(e,r)=>t.downloadTensor(e,r),(e,r)=>t.registerMLContext(e,r),!!e.trace])}},qt=new Map,Yt=e=>{let t=Fe(),r=t.stackSave();try{let r=t.PTR_SIZE,n=t.stackAlloc(2*r);0!==t._OrtGetInputOutputCount(e,n,n+r)&&He("Can't get session input/output count.");let i=4===r?"i32":"i64";return[Number(t.getValue(n,i)),Number(t.getValue(n+r,i))]}finally{t.stackRestore(r)}},Zt=(e,t)=>{let r=Fe(),n=r.stackSave(),i=0;try{let n=r.PTR_SIZE,a=r.stackAlloc(2*n);0!==r._OrtGetInputOutputMetadata(e,t,a,a+n)&&He("Can't get session input/output metadata.");let o=Number(r.getValue(a,"*"));i=Number(r.getValue(a+n,"*"));let s=r.HEAP32[i/4];if(0===s)return[o,0];let l=r.HEAPU32[i/4+1],u=[];for(let e=0;e<l;e++){let t=Number(r.getValue(i+8+e*n,"*"));u.push(0!==t?r.UTF8ToString(t):Number(r.getValue(i+8+(e+l)*n,"*")))}return[o,s,u]}finally{r.stackRestore(n),0!==i&&r._OrtFree(i)}},Xt=e=>{let t=Fe(),r=t._malloc(e.byteLength);if(0===r)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,r),[r,e.byteLength]},Qt=async(e,t)=>{let r,n,i=Fe();Array.isArray(e)?[r,n]=e:e.buffer===i.HEAPU8.buffer?[r,n]=[e.byteOffset,e.byteLength]:[r,n]=Xt(e);let a=0,o=0,s=0,l=[],u=[],f=[];try{if([o,l]=await et(t),t?.externalData&&i.mountExternalData){let e=[];for(let r of t.externalData){let t="string"==typeof r?r:r.path;e.push(ut("string"==typeof r?r:r.data).then(e=>{i.mountExternalData(t,e)}))}await Promise.all(e)}for(let e of t?.executionProviders??[])if("webnn"===("string"==typeof e?e:e.name)){if(i.shouldTransferToMLTensor=!1,"string"!=typeof e){let t=e,r=t?.context,n=t?.gpuDevice,a=t?.deviceType,o=t?.powerPreference;i.currentContext=r||(n?await i.webnnCreateMLContext(n):await i.webnnCreateMLContext({deviceType:a,powerPreference:o}))}else i.currentContext=await i.webnnCreateMLContext();break}a=await i._OrtCreateSession(r,n,o),i.webgpuOnCreateSession?.(a),0===a&&He("Can't create a session."),i.jsepOnCreateSession?.(),i.currentContext&&(i.webnnRegisterMLContext(a,i.currentContext),i.currentContext=void 0,i.shouldTransferToMLTensor=!0);let[e,d]=Yt(a),c=!!t?.enableGraphCapture,p=[],h=[],y=[],m=[],w=[];for(let t=0;t<e;t++){let[e,r,n]=Zt(a,t);0===e&&He("Can't get an input name."),u.push(e);let o=i.UTF8ToString(e);p.push(o),y.push(0===r?{name:o,isTensor:!1}:{name:o,isTensor:!0,type:rt(r),shape:n})}for(let r=0;r<d;r++){let[n,o,s]=Zt(a,r+e);0===n&&He("Can't get an output name."),f.push(n);let l=i.UTF8ToString(n);h.push(l),m.push(0===o?{name:l,isTensor:!1}:{name:l,isTensor:!0,type:rt(o),shape:s});{if(c&&void 0===t?.preferredOutputLocation){w.push("gpu-buffer");continue}let e="string"==typeof t?.preferredOutputLocation?t.preferredOutputLocation:t?.preferredOutputLocation?.[l]??"cpu",r=i.webnnIsGraphOutput;if("cpu"===e&&r&&r(a,l)){w.push("ml-tensor-cpu-output");continue}if("cpu"!==e&&"cpu-pinned"!==e&&"gpu-buffer"!==e&&"ml-tensor"!==e)throw new Error(`Not supported preferred output location: ${e}.`);if(c&&"gpu-buffer"!==e)throw new Error(`Not supported preferred output location: ${e}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);w.push(e)}}let g=null;return w.some(e=>"gpu-buffer"===e||"ml-tensor"===e||"ml-tensor-cpu-output"===e)&&(s=i._OrtCreateBinding(a),0===s&&He("Can't create IO binding."),g={handle:s,outputPreferredLocations:w,outputPreferredLocationsEncoded:w.map(e=>"ml-tensor-cpu-output"===e?"ml-tensor":e).map(e=>lt(e))}),qt.set(a,[a,u,f,g,c,!1]),[a,p,h,y,m]}catch(e){throw u.forEach(e=>i._OrtFree(e)),f.forEach(e=>i._OrtFree(e)),0!==s&&0!==i._OrtReleaseBinding(s)&&He("Can't release IO binding."),0!==a&&0!==i._OrtReleaseSession(a)&&He("Can't release session."),e}finally{i._free(r),0!==o&&0!==i._OrtReleaseSessionOptions(o)&&He("Can't release session options."),l.forEach(e=>i._free(e)),i.unmountExternalData?.()}},Kt=e=>{let t=Fe(),r=qt.get(e);if(!r)throw new Error(`cannot release session. invalid session id: ${e}`);let[n,i,a,o,s]=r;o&&(s&&0!==t._OrtClearBoundOutputs(o.handle)&&He("Can't clear bound outputs."),0!==t._OrtReleaseBinding(o.handle)&&He("Can't release IO binding.")),t.jsepOnReleaseSession?.(e),t.webnnOnReleaseSession?.(e),t.webgpuOnReleaseSession?.(e),i.forEach(e=>t._OrtFree(e)),a.forEach(e=>t._OrtFree(e)),0!==t._OrtReleaseSession(n)&&He("Can't release session."),qt.delete(e)},Jt=async(e,t,r,n,i,a,o=!1)=>{if(!e)return void t.push(0);let s,l,u=Fe(),f=u.PTR_SIZE,d=e[0],c=e[1],p=e[3],h=p;if("string"===d&&("gpu-buffer"===p||"ml-tensor"===p))throw new Error("String tensor is not supported on GPU.");if(o&&"gpu-buffer"!==p)throw new Error(`External buffer must be provided for input/output index ${a} when enableGraphCapture is true.`);if("gpu-buffer"===p){let t=e[2].gpuBuffer;l=nt(tt(d),c);{let e=u.webgpuRegisterBuffer;if(!e)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');s=e(t,n)}}else if("ml-tensor"===p){let t=e[2].mlTensor;l=nt(tt(d),c);let r=u.webnnRegisterMLTensor;if(!r)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');s=r(n,t,tt(d),c)}else{let t=e[2];if(Array.isArray(t)){l=f*t.length,s=u._malloc(l),r.push(s);for(let e=0;e<t.length;e++){if("string"!=typeof t[e])throw new TypeError(`tensor data at index ${e} is not a string`);u.setValue(s+e*f,Ve(t[e],r),"*")}}else{let e=u.webnnIsGraphInput,a=u.webnnIsGraphOutput;if("string"!==d&&e&&a){let o=u.UTF8ToString(i);if(e(n,o)||a(n,o)){let e=tt(d);l=nt(e,c),h="ml-tensor";let r=u.webnnCreateTemporaryTensor,i=u.webnnUploadTensor;if(!r||!i)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let a=await r(n,e,c);i(a,new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),s=a}else l=t.byteLength,s=u._malloc(l),r.push(s),u.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,l),s)}else l=t.byteLength,s=u._malloc(l),r.push(s),u.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,l),s)}}let y=u.stackSave(),m=u.stackAlloc(4*c.length);try{c.forEach((e,t)=>u.setValue(m+t*f,e,4===f?"i32":"i64"));let e=u._OrtCreateTensor(tt(d),s,l,m,c.length,lt(h));0===e&&He(`Can't create tensor for input/output. session=${n}, index=${a}.`),t.push(e)}finally{u.stackRestore(y)}},er=async(e,t,r,n,i,a)=>{let o=Fe(),s=o.PTR_SIZE,l=qt.get(e);if(!l)throw new Error(`cannot run inference. invalid session id: ${e}`);let u=l[0],f=l[1],d=l[2],c=l[3],p=l[4],h=l[5],y=t.length,m=n.length,w=0,g=[],b=[],v=[],C=[],_=o.stackSave(),T=o.stackAlloc(y*s),E=o.stackAlloc(y*s),x=o.stackAlloc(m*s),A=o.stackAlloc(m*s);try{[w,g]=qe(a),R("wasm prepareInputOutputTensor");for(let n=0;n<y;n++)await Jt(r[n],b,C,e,f[t[n]],t[n],p);for(let t=0;t<m;t++)await Jt(i[t],v,C,e,d[n[t]],y+n[t],p);$("wasm prepareInputOutputTensor");for(let e=0;e<y;e++)o.setValue(T+e*s,b[e],"*"),o.setValue(E+e*s,f[t[e]],"*");for(let e=0;e<m;e++)o.setValue(x+e*s,v[e],"*"),o.setValue(A+e*s,d[n[e]],"*");if(c&&!h){let{handle:r,outputPreferredLocations:a,outputPreferredLocationsEncoded:s}=c;if(f.length!==y)throw new Error(`input count from feeds (${y}) is expected to be always equal to model's input count (${f.length}).`);R("wasm bindInputsOutputs");for(let n=0;n<y;n++){let i=t[n];0!==await o._OrtBindInput(r,f[i],b[n])&&He(`Can't bind input[${n}] for session=${e}.`)}for(let t=0;t<m;t++){let l=n[t];i[t]?.[3]?0!==o._OrtBindOutput(r,d[l],v[t],0)&&He(`Can't bind pre-allocated output[${t}] for session=${e}.`):0!==o._OrtBindOutput(r,d[l],0,s[l])&&He(`Can't bind output[${t}] to ${a[t]} for session=${e}.`)}$("wasm bindInputsOutputs"),qt.set(e,[u,f,d,c,p,!0])}let l;o.jsepOnRunStart?.(u),o.webnnOnRunStart?.(u),l=c?await o._OrtRunWithBinding(u,c.handle,m,x,w):await o._OrtRun(u,E,T,y,A,m,x,w),0!==l&&He("failed to call OrtRun().");let _=[],O=[];R("wasm ProcessOutputTensor");for(let t=0;t<m;t++){let r=Number(o.getValue(x+t*s,"*"));if(r===v[t]){_.push(i[t]);continue}let a,l=o.stackSave(),u=o.stackAlloc(4*s),f=!1,d=0;try{0!==o._OrtGetTensorData(r,u,u+s,u+2*s,u+3*s)&&He(`Can't access output tensor data on index ${t}.`);let i=4===s?"i32":"i64",l=Number(o.getValue(u,i));d=o.getValue(u+s,"*");let p=o.getValue(u+2*s,"*"),h=Number(o.getValue(u+3*s,i)),y=[];for(let e=0;e<h;e++)y.push(Number(o.getValue(p+e*s,i)));0!==o._OrtFree(p)&&He("Can't free memory for tensor dims.");let m=y.reduce((e,t)=>e*t,1);a=rt(l);let w=c?.outputPreferredLocations[n[t]];if("string"===a){if("gpu-buffer"===w||"ml-tensor"===w)throw new Error("String tensor is not supported on GPU.");let e=[];for(let t=0;t<m;t++){let r=o.getValue(d+t*s,"*"),n=o.getValue(d+(t+1)*s,"*"),i=t===m-1?void 0:n-r;e.push(o.UTF8ToString(r,i))}_.push([a,y,e,"cpu"])}else if("gpu-buffer"===w&&m>0){let t=o.webgpuGetBuffer;if(!t)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let n=t(d),i=nt(l,m);if(void 0===i||!ot(a))throw new Error(`Unsupported data type: ${a}`);f=!0;{o.webgpuRegisterBuffer(n,e,d);let t=o.webgpuCreateDownloader(n,i,e);_.push([a,y,{gpuBuffer:n,download:async()=>{let e=await t();return new(it(a))(e)},dispose:()=>{0!==o._OrtReleaseTensor(r)&&He("Can't release tensor.")}},"gpu-buffer"])}}else if("ml-tensor"===w&&m>0){let t=o.webnnEnsureTensor,n=o.webnnIsGraphInputOutputTypeSupported;if(!t||!n)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(void 0===nt(l,m)||!st(a))throw new Error(`Unsupported data type: ${a}`);if(!n(e,a,!1))throw new Error(`preferredLocation "ml-tensor" for ${a} output is not supported by current WebNN Context.`);let i=await t(e,d,l,y,!1);f=!0,_.push([a,y,{mlTensor:i,download:o.webnnCreateMLTensorDownloader(d,a),dispose:()=>{o.webnnReleaseTensorId(d),o._OrtReleaseTensor(r)}},"ml-tensor"])}else if("ml-tensor-cpu-output"===w&&m>0){let e=o.webnnCreateMLTensorDownloader(d,a)(),t=_.length;f=!0,O.push((async()=>{let n=[t,await e];return o.webnnReleaseTensorId(d),o._OrtReleaseTensor(r),n})()),_.push([a,y,[],"cpu"])}else{let e=new(it(a))(m);new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(o.HEAPU8.subarray(d,d+e.byteLength)),_.push([a,y,e,"cpu"])}}finally{o.stackRestore(l),"string"===a&&d&&o._free(d),f||o._OrtReleaseTensor(r)}}c&&!p&&(0!==o._OrtClearBoundOutputs(c.handle)&&He("Can't clear bound outputs."),qt.set(e,[u,f,d,c,p,!1]));for(let[e,t]of await Promise.all(O))_[e][2]=t;return $("wasm ProcessOutputTensor"),_}finally{o.webnnOnRunEnd?.(u),o.stackRestore(_),r.forEach(e=>{e&&"gpu-buffer"===e[3]&&o.webgpuUnregisterBuffer(e[2].gpuBuffer)}),i.forEach(e=>{e&&"gpu-buffer"===e[3]&&o.webgpuUnregisterBuffer(e[2].gpuBuffer)}),b.forEach(e=>o._OrtReleaseTensor(e)),v.forEach(e=>o._OrtReleaseTensor(e)),C.forEach(e=>o._free(e)),0!==w&&o._OrtReleaseRunOptions(w),g.forEach(e=>o._free(e))}},tr=e=>{let t=Fe(),r=qt.get(e);if(!r)throw new Error("invalid session id");let n=r[0],i=t._OrtEndProfiling(n);0===i&&He("Can't get an profile file name."),t._OrtFree(i)},rr=e=>{let t=[];for(let r of e){let e=r[2];!Array.isArray(e)&&"buffer"in e&&t.push(e.buffer)}return t}}),Ar=G(()=>{fe(),xr(),Ut(),Bt(),nr=()=>!!c.wasm.proxy&&typeof document<"u",ar=!1,or=!1,sr=!1,fr=new Map,dr=(e,t)=>{let r=fr.get(e);r?r.push(t):fr.set(e,[t])},cr=()=>{if(ar||!or||sr||!ir)throw new Error("worker not ready")},pr=e=>{switch(e.data.type){case"init-wasm":ar=!1,e.data.err?(sr=!0,ur[1](e.data.err)):(or=!0,ur[0]()),lr&&(URL.revokeObjectURL(lr),lr=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=fr.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out);break}}},hr=async()=>{if(!or){if(ar)throw new Error("multiple calls to 'initWasm()' detected.");if(sr)throw new Error("previous call to 'initWasm()' failed.");if(ar=!0,nr())return new Promise((e,t)=>{ir?.terminate(),Me().then(([n,i])=>{try{(ir=i).onerror=e=>t(e),ir.onmessage=pr,ur=[e,t];let a={type:"init-wasm",in:c};!a.in.wasm.wasmPaths&&(n||_e)&&(a.in.wasm.wasmPaths={wasm:new URL(r(/*! ort-wasm-simd-threaded.asyncify.wasm */"./node_modules/onnxruntime-web/dist/ort-wasm-simd-threaded.asyncify.wasm"),r.b).href}),ir.postMessage(a),lr=n}catch(e){t(e)}},t)});try{await Ge(c.wasm),await zt(c),or=!0}catch(e){throw sr=!0,e}finally{ar=!1}}},yr=async e=>{if(nr())return cr(),new Promise((t,r)=>{dr("init-ep",[t,r]);let n={type:"init-ep",in:{epName:e,env:c}};ir.postMessage(n)});await Ht(c,e)},mr=async e=>nr()?(cr(),new Promise((t,r)=>{dr("copy-from",[t,r]);let n={type:"copy-from",in:{buffer:e}};ir.postMessage(n,[e.buffer])})):Xt(e),wr=async(e,t)=>{if(nr()){if(t?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return cr(),new Promise((r,n)=>{dr("create",[r,n]);let i={type:"create",in:{model:e,options:{...t}}},a=[];e instanceof Uint8Array&&a.push(e.buffer),ir.postMessage(i,a)})}return Qt(e,t)},gr=async e=>{if(nr())return cr(),new Promise((t,r)=>{dr("release",[t,r]);let n={type:"release",in:e};ir.postMessage(n)});Kt(e)},br=async(e,t,r,n,i,a)=>{if(nr()){if(r.some(e=>"cpu"!==e[3]))throw new Error("input tensor on GPU is not supported for proxy.");if(i.some(e=>e))throw new Error("pre-allocated output tensor is not supported for proxy.");return cr(),new Promise((i,o)=>{dr("run",[i,o]);let s=r,l={type:"run",in:{sessionId:e,inputIndices:t,inputs:s,outputIndices:n,options:a}};ir.postMessage(l,rr(s))})}return er(e,t,r,n,i,a)},vr=async e=>{if(nr())return cr(),new Promise((t,r)=>{dr("end-profiling",[t,r]);let n={type:"end-profiling",in:e};ir.postMessage(n)});tr(e)}}),Or=G(()=>{fe(),Ar(),Pt(),de(),jt(),Cr=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${t()}`)}},_r=e=>{switch(e[3]){case"cpu":return new I(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!ot(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:r,download:n,dispose:i}=e[2];return I.fromGpuBuffer(r,{dataType:t,dims:e[1],download:n,dispose:i})}case"ml-tensor":{let t=e[0];if(!st(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:r,download:n,dispose:i}=e[2];return I.fromMLTensor(r,{dataType:t,dims:e[1],download:n,dispose:i})}default:throw new Error(`invalid data location: ${e[3]}`)}},Tr=class{async fetchModelAndCopyToWasmMemory(e){return mr(await ut(e))}async loadModel(e,t){let r;U(),r="string"==typeof e?await this.fetchModelAndCopyToWasmMemory(e):e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await wr(r,t),M()}async dispose(){return gr(this.sessionId)}async run(e,t,r){U();let n=[],i=[];Object.entries(e).forEach(e=>{let t=e[0],r=e[1],a=this.inputNames.indexOf(t);if(-1===a)throw new Error(`invalid input '${t}'`);n.push(r),i.push(a)});let a=[],o=[];Object.entries(t).forEach(e=>{let t=e[0],r=e[1],n=this.outputNames.indexOf(t);if(-1===n)throw new Error(`invalid output '${t}'`);a.push(r),o.push(n)});let s=n.map((e,t)=>Cr(e,()=>`input "${this.inputNames[i[t]]}"`)),l=a.map((e,t)=>e?Cr(e,()=>`output "${this.outputNames[o[t]]}"`):null),u=await br(this.sessionId,i,s,o,l,r),f={};for(let e=0;e<u.length;e++)f[this.outputNames[o[e]]]=a[e]??_r(u[e]);return M(),f}startProfiling(){}endProfiling(){vr(this.sessionId)}}}),Ir={};F(Ir,{OnnxruntimeWebAssemblyBackend:()=>Br,initializeFlags:()=>Sr,wasmBackend:()=>Ur});var Sr,Br,Ur,Mr=G(()=>{fe(),Ar(),Or(),Sr=()=>{("number"!=typeof c.wasm.initTimeout||c.wasm.initTimeout<0)&&(c.wasm.initTimeout=0);let e=c.wasm.simd;if("boolean"!=typeof e&&void 0!==e&&"fixed"!==e&&"relaxed"!==e&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${e}". Reset it to \`false\` and ignore SIMD feature checking.`),c.wasm.simd=!1),"boolean"!=typeof c.wasm.proxy&&(c.wasm.proxy=!1),"boolean"!=typeof c.wasm.trace&&(c.wasm.trace=!1),"number"!=typeof c.wasm.numThreads||!Number.isInteger(c.wasm.numThreads)||c.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)c.wasm.numThreads=1;else{let e=typeof navigator>"u"?W("node:os").cpus().length:navigator.hardwareConcurrency;c.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},Ur=new(Br=class{async init(e){Sr(),await hr(),await yr(e)}async createInferenceSessionHandler(e,t){let r=new Tr;return await r.loadModel(e,t),r}})});fe(),fe(),fe();var Rr=ue;{let e=(Mr(),V(Ir)).wasmBackend;o("webgpu",e,5),o("webnn",e,5),o("cpu",e,10),o("wasm",e,10)}Object.defineProperty(c.versions,"web",{value:"1.23.2",enumerable:!0})}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.m=e,r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;if("string"==typeof import.meta.url&&(e=import.meta.url),!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e+"../"})(),r.b=new URL("../",import.meta.url);var n={};(()=>{
/*!******************!*\
  !*** ./index.js ***!
  \******************/
r.r(n);var e=r(/*! onnxruntime-web/webgpu */"./node_modules/onnxruntime-web/dist/ort.webgpu.bundle.min.mjs?79d7");function t(e){console.log(e),document.getElementById("status").innerText+=`\n${e}`}function i(e,t){function r(){let e=Math.random(),t=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}let n=1;e.forEach(e=>{n*=e});let i=new Float32Array(n);for(let e=0;e<n;e++)i[e]=r()*t;return i}async function a(e,t){const r=`${e}/${t}`;if(t.endsWith(".onnx_data")){const e=await fetch(r);if(!e.ok)throw new Error(`HTTP ${e.status} when fetching ${r}`);return await e.arrayBuffer()}try{const e=await caches.open("onnx");let t=await e.match(r);null==t&&(await e.add(r),t=await e.match(r));return await t.arrayBuffer()}catch(e){const t=await fetch(r);if(!t.ok)throw new Error(`HTTP ${t.status} when fetching ${r}`);return await t.arrayBuffer()}}const o=function(){var e={model:"https://huggingface.co/ykeee/sd-turbo-onnx-fp32/resolve/main",provider:"webgpu",device:"gpu",threads:"1",images:"2"};let t=window.location.search.substring(1).split("&");for(var r=0;r<t.length;r++){let n=t[r].split("=");if(n[0]in e)e[n[0]]=decodeURIComponent(n[1]);else if(n[0].length>0)throw new Error("unknown argument: "+n[0])}return e.threads=parseInt(e.threads),e.images=parseInt(e.images),e}(),s={unet:{url:"unet/model.onnx",size:640,external:"unet/model.onnx_data",opt:{freeDimensionOverrides:{batch_size:1,num_channels:4,height:64,width:64,sequence_length:77}}},text_encoder:{url:"text_encoder/model.onnx",size:1700,opt:{freeDimensionOverrides:{batch_size:1}}},vae_decoder:{url:"vae_decoder/model.onnx",size:95,opt:{freeDimensionOverrides:{batch_size:1,num_channels_latent:4,height_latent:64,width_latent:64}}}};let l,u;e.default.env.wasm.wasmPaths="https://cdn.jsdelivr.net/npm/onnxruntime-web@latest/dist/",e.default.env.wasm.numThreads=1,e.default.env.wasm.simd=!0,e.default.env.logLevel="error";const f=14.6146,d=document.getElementById("user-input");d.value="Paris with the river in the background";const c={executionProviders:[o.provider],enableMemPattern:!1,enableCpuMemArena:!1,extra:{session:{disable_prepacking:"1",use_device_allocator_for_initializers:"1",use_ort_model_bytes_directly:"1",use_ort_model_bytes_for_initializers:"1"}}};switch(o.provider){case"webgpu":if(!("gpu"in navigator))throw new Error("webgpu is NOT supported");c.preferredOutputLocation={last_hidden_state:"gpu-buffer"};break;case"webnn":if(!("ml"in navigator))throw new Error("webnn is NOT supported");c.executionProviders=[{name:"webnn",deviceType:o.device,powerPreference:"default"}]}function p(t){const r=t.data,n=new Float32Array(r.length);for(let e=0;e<r.length;e++)n[e]=r[e]/14.64877241136608;return new e.default.Tensor(n,t.dims)}function h(t,r){const n=new Float32Array(t.data.length),i=new e.default.Tensor(n,t.dims),a=14.6146;for(let e=0;e<t.data.length;e++){const i=r.data[e]-a*t.data[e],o=(r.data[e]-i)/a,s=-14.6146;n[e]=(r.data[e]+o*s)/.18215}return i}function y(e,t){let r=e.data;for(var n=0;n<r.length;n++){let e=r[n];e=e/2+.5,e<0&&(e=0),e>1&&(e=1),r[n]=e}const i=e.toImageData({tensorLayout:"NCWH",format:"RGB"}),a=document.getElementById(`img_canvas_${t}`);a.width=i.width,a.height=i.height,a.getContext("2d").putImageData(i,0,0);document.getElementById(`img_div_${t}`).style.opacity=1}async function m(){try{document.getElementById("status").innerText="generating ...",void 0===l&&(l=await AutoTokenizer.from_pretrained("Xenova/clip-vit-base-patch16"),l.pad_token_id=0);await u;const r=parseInt(document.getElementById("num-images").value)||o.images;for(let e=0;e<r;e++){document.getElementById(`img_div_${e}`).style.opacity=.5}const{input_ids:n}=await l(d.value,{padding:!0,max_length:77,truncation:!0,return_tensor:!1});let a=performance.now();const c=function(e){const t=Array.isArray(e)?e:Array.from(e),r=new BigInt64Array(t.length);for(let e=0;e<t.length;e++)r[e]=BigInt(t[e]);return r}(n),{last_hidden_state:m}=await s.text_encoder.sess.run({input_ids:new e.default.Tensor("int64",c,[1,n.length])});let w=[`text_encoder: ${(performance.now()-a).toFixed(1)}ms`];const g=[1,4,64,64],b=i(g,f);let v=[];for(let n=0;n<r;n++){const o=n/Math.max(r-1,1),l=new Float32Array(b.length),u=i(g,.15*f),d=.92+.03*Math.sin(o*Math.PI*2),c=1-d;for(let e=0;e<b.length;e++)l[e]=b[e]*d+u[e]*c;let C=new e.default.Tensor(l,g);const _=p(C);a=performance.now();let T={sample:_,timestep:new e.default.Tensor("float32",new Float32Array([999]),[]),encoder_hidden_states:m},{out_sample:E}=await s.unet.sess.run(T);w.push(`unet: ${(performance.now()-a).toFixed(1)}ms`);const x=h(E,C);a=performance.now();const{sample:A}=await s.vae_decoder.sess.run({latent_sample:x});w.push(`vae_decoder: ${(performance.now()-a).toFixed(1)}ms`),y(A,n);const O=A.toImageData({tensorLayout:"NCWH",format:"RGB"});v.push(O),t(w.join(", ")),w=[]}r>1&&await async function(e,r){try{t("Generating video...");const n=document.createElement("canvas");n.width=512,n.height=512;const i=n.getContext("2d"),a=n.captureStream(8),o=new MediaRecorder(a,{mimeType:"video/webm"}),s=[];o.ondataavailable=e=>s.push(e.data),o.onstop=()=>{const e=new Blob(s,{type:"video/webm"}),r=URL.createObjectURL(e),n=document.getElementById("video-player");n.src=r,n.style.display="block";const i=document.getElementById("download-video-btn");i.style.display="inline-block",i.onclick=()=>{const e=document.createElement("a");e.href=r,e.download="generated_video.webm",e.click()},t("Video ready!")},o.start();for(let t=0;t<e.length;t++)i.putImageData(e[t],0,0),await new Promise(e=>setTimeout(e,125));o.stop();const l=document.getElementById("frame-slider");l.max=r-1,l.value=0,l.style.display="block",document.getElementById("slider-label").style.display="block",l.oninput=e=>{const t=parseInt(e.target.value);document.getElementById("slider-label").innerText=`Frame: ${t+1}/${r}`;for(let e=0;e<r;e++)document.getElementById(`img_div_${e}`).style.border=e===t?"3px solid yellow":"none"}}catch(e){t(`Video generation failed: ${e}`)}}(v,r),m.dispose(),t("done")}catch(e){t(e)}}document.getElementById("user-input").addEventListener("keydown",function(e){e.ctrlKey&&"Enter"===e.key&&m()}),document.getElementById("send-button").addEventListener("click",function(e){m()}),document.addEventListener("DOMContentLoaded",()=>{(async function(){try{return(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch(e){return!1}})().then(r=>{r?u=async function(r){t("loading models...");for(const[n,i]of Object.entries(r))try{const s=performance.now();let l={...c,...i.opt};if(i.external){const t=`${o.model}/${i.url}`,a=`${o.model}/${i.external}`;l={...l,externalData:[{path:"./model.onnx_data",data:a}]},r[n].sess=await e.default.InferenceSession.create(t,l)}else{const t=await a(o.model,i.url);r[n].sess=await e.default.InferenceSession.create(t,l)}t(`${n} loaded in ${(performance.now()-s).toFixed(1)}ms`)}catch(e){t(`${n} failed: ${e}`)}t("All models ready.")}(s):t("Your GPU or Browser doesn't support webgpu/f16")})})})();
//# sourceMappingURL=index.min.js.map